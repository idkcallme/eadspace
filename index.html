<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EADSPACE ▸ Hack the Signal</title>
  
  <!-- Defensive Headers & Anti-Reconnaissance -->
  <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex" />
  <meta name="googlebot" content="noindex, nofollow, noarchive, nosnippet, noimageindex" />
  <meta name="referrer" content="no-referrer" />
  <meta http-equiv="X-Frame-Options" content="DENY" />
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com; style-src 'self' 'unsafe-inline' https://unpkg.com https://fonts.googleapis.com https://basemaps.cartocdn.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https://basemaps.cartocdn.com https://*.basemaps.cartocdn.com https://*.tile.openstreetmap.org; connect-src 'self' https://ipapi.co https://ifconfig.co https://ipinfo.io https://demotiles.maplibre.org https://basemaps.cartocdn.com https://*.basemaps.cartocdn.com; worker-src 'self' blob:;" />
  <meta name="description" content="System maintenance in progress. Access restricted." />
  
  <!-- Fake Server Fingerprints -->
  <meta name="generator" content="Apache/2.4.41 (Ubuntu)" />
  <meta name="server" content="nginx/1.18.0" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet" />
  
  <!-- MapLibre GL (no key required) -->
  <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
  
  <!-- ─── Leaflet assets (tiny, 40 kB combined) ────────────── -->
  <link  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"  rel="stylesheet">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    :root {
      --bg: #000;
      --fg: #fff;
      --code: #c0c0c0;
      --scroll-speed: 36s;
      --glitch-speed: 1s;
    }

    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html,body{width:100%;height:100%;background:var(--bg);color:var(--fg);font-family:'Roboto Mono',monospace;overflow-x:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
    ::selection{background:transparent}

    /* ——— HERO ——— */
    #hero{position:relative;height:100vh;display:flex;align-items:center;justify-content:center;overflow:hidden}

    .code-layer{position:absolute;top:0;height:200%;line-height:1.25em;font-size:.75rem;white-space:pre;color:var(--code);pointer-events:none;animation:scrollUp var(--scroll-speed) linear infinite}
    /* two columns */
    .left{left:0;width:42%;text-align:right;padding-right:2vw}
    .right{right:0;width:42%;text-align:left;padding-left:2vw}
    .offset{top:100%}

    @keyframes scrollUp{0%{transform:translateY(0)}100%{transform:translateY(-100%)}}

    /* ——— LOGO ——— */
    .logo{font-family:'Press Start 2P',monospace;font-size:6vw;letter-spacing:.15em;color:var(--fg);text-shadow:0 0 8px #fff;position:relative;z-index:10}
    .logo::before,.logo::after{content:attr(data-text);position:absolute;top:0;left:0;width:100%;color:var(--fg);mix-blend-mode:difference;animation:glitch var(--glitch-speed) steps(2,end) infinite;overflow:hidden}
    .logo::after{animation-delay:calc(var(--glitch-speed)/2)}
    @keyframes glitch{
      0%{clip-path:inset(15% 0 75% 0);transform:translateX(-2px)}
      10%{clip-path:inset(40% 0 45% 0);transform:translateX(2px)}
      20%{clip-path:inset(70% 0 10% 0);transform:translateX(-3px)}
      30%{clip-path:inset(5% 0 90% 0);transform:translateX(3px)}
      40%,100%{clip-path:inset(0 0 100% 0);transform:none}
    }
    /* extra flicker */
    .logo{animation:flicker 3s infinite}
    @keyframes flicker{
      0%,19%,21%,23%,25%,54%,56%,100%{opacity:1}
      20%,24%,55%{opacity:.25}
    }
    
    /* ——— SELECTION PROTECTION ——— */
    .code-layer, .logo {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    /* ——— FAKE OUTPUT OVERLAY ——— */
    #output{position:absolute;bottom:2vh;left:50%;transform:translateX(-50%);font-size:.8rem;color:#7cff7c;font-family:'Roboto Mono',monospace;white-space:pre;pointer-events:none;opacity:.85;text-shadow:0 0 4px #7cff7c}

    /* ——— TERMINAL INTERFACE ——— */
    #terminal{position:fixed;top:-100%;left:50%;transform:translateX(-50%);width:90vw;max-width:1000px;height:70vh;background:rgba(0,0,0,0.95);border:2px solid #7cff7c;border-radius:8px;z-index:1000;transition:top 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);overflow:hidden;box-shadow:0 0 30px rgba(124,255,124,0.3)}
    #terminal.active{top:15vh}
    .terminal-header{background:#1a1a1a;padding:10px 20px;border-bottom:1px solid #333;display:flex;justify-content:space-between;align-items:center}
    .terminal-title{color:#7cff7c;font-family:'Roboto Mono',monospace;font-size:0.9rem}
    .terminal-close{color:#ff6b6b;cursor:pointer;font-size:1.2rem;padding:5px}
    .terminal-body{padding:20px;height:calc(100% - 60px);overflow-y:auto;font-family:'Roboto Mono',monospace;font-size:0.85rem}
    .terminal-line{margin:2px 0;color:#7cff7c}
    .terminal-prompt{color:#fff}
    .terminal-cursor{animation:blink 1s infinite}
    @keyframes blink{0%,50%{opacity:1}51%,100%{opacity:0}}

    /* ——— FINGERPRINT SCANNER ——— */
    #fingerprint{position:fixed;bottom:-200px;right:30px;width:150px;height:150px;background:radial-gradient(circle,rgba(124,255,124,0.1) 30%,transparent 70%);border:2px solid #7cff7c;border-radius:50%;transition:bottom 0.5s ease;z-index:1000}
    #fingerprint.active{bottom:30px}
    .fp-scanner{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80px;height:80px;border:2px solid #7cff7c;border-radius:50%;display:flex;align-items:center;justify-content:center}
    .fp-lines{position:absolute;width:60px;height:60px;opacity:0.6}
    .fp-line{position:absolute;border:1px solid #7cff7c;border-radius:50%}
    .fp-line:nth-child(1){width:20px;height:20px;top:20px;left:20px}
    .fp-line:nth-child(2){width:35px;height:35px;top:12px;left:12px}
    .fp-line:nth-child(3){width:50px;height:50px;top:5px;left:5px}

    /* ——— DATA STREAM OVERLAY ——— */
    #datastream{position:fixed;top:0;right:-300px;width:280px;height:100vh;background:linear-gradient(180deg,rgba(0,0,0,0.9) 0%,rgba(0,20,0,0.9) 100%);border-left:1px solid #7cff7c;transition:right 0.5s ease;z-index:999;overflow:hidden}
    #datastream.active{right:0}
    .stream-header{padding:20px;border-bottom:1px solid #333;color:#7cff7c;font-family:'Press Start 2P',monospace;font-size:0.7rem}
    .stream-content{padding:15px;font-family:'Roboto Mono',monospace;font-size:0.7rem;height:calc(100% - 80px);overflow-y:auto}
    .data-packet{margin:10px 0;padding:8px;background:rgba(124,255,124,0.05);border-left:3px solid #7cff7c}

    /* ——— ACCESS PANEL ——— */
    #access-panel{position:fixed;top:50%;left:-350px;transform:translateY(-50%);width:320px;height:400px;background:rgba(0,0,0,0.95);border:2px solid #ff6b6b;border-radius:8px;transition:left 0.5s ease;z-index:1001}
    #access-panel.active{left:30px}
    .panel-header{background:#1a1a1a;padding:15px;border-bottom:1px solid #ff6b6b;color:#ff6b6b;font-family:'Press Start 2P',monospace;font-size:0.8rem}
    .security-grid{padding:20px;display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .security-node{width:60px;height:60px;border:2px solid #666;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s ease;font-size:0.8rem}
    .security-node:hover{border-color:#ff6b6b;background:rgba(255,107,107,0.1)}
    .security-node.active{border-color:#7cff7c;background:rgba(124,255,124,0.1);color:#7cff7c}

    /* ——— MATRIX RAIN EFFECT ——— */
    #matrix{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:-1;opacity:0.1}
    .matrix-column{position:absolute;top:-100%;font-family:'Roboto Mono',monospace;font-size:12px;color:#7cff7c;white-space:nowrap;animation:matrixFall linear infinite}
    @keyframes matrixFall{to{transform:translateY(100vh)}}

    /* ——— WORLD MAP BACKGROUND ——— */
    #world-map{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:-2;opacity:0.15;background-image:url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyMCIgaGVpZ2h0PSIxMDgwIiB2aWV3Qm94PSIwIDAgMTkyMCAxMDgwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xMDA3IDI3MUM5NzguNSAyNzEgOTU1IDI5NC41IDk1NSAzMjNDOTU1IDM1MS41IDk3OC41IDM3NSAxMDA3IDM3NUMxMDM1LjUgMzc1IDEwNTkgMzUxLjUgMTA1OSAzMjNDMTA1OSAyOTQuNSAxMDM1LjUgMjcxIDEwMDcgMjcxWiIgZmlsbD0iIzdDRkY3QyIgZmlsbC1vcGFjaXR5PSIwLjMiLz48L3N2Zz4=');background-size:cover;background-position:center;background-repeat:no-repeat}
    
    /* User Location Ping */
    .location-ping{position:absolute;width:20px;height:20px;border-radius:50%;background:#ff6b6b;opacity:0;z-index:1}
    .location-ping::before{content:'';position:absolute;top:-5px;left:-5px;width:30px;height:30px;border-radius:50%;border:2px solid #ff6b6b;animation:pingPulse 2s infinite}
    .location-ping.active{opacity:1;animation:locationBlink 1s infinite}
    @keyframes pingPulse{0%{transform:scale(0);opacity:1}100%{transform:scale(1.5);opacity:0}}
    @keyframes locationBlink{0%,50%{opacity:1}51%,100%{opacity:0.3}}

    /* Traceroute Terminal */
    #traceroute-terminal{position:fixed;top:20px;left:50%;transform:translateX(-50%);width:600px;max-height:200px;background:rgba(0,0,0,0.95);border:2px solid #7cff7c;border-radius:8px;padding:15px;font-family:'Roboto Mono',monospace;font-size:0.75rem;color:#7cff7c;opacity:0;transition:opacity 0.5s ease;z-index:1002;overflow-y:auto}
    #traceroute-terminal.active{opacity:1}
    .trace-line{margin:2px 0;white-space:nowrap}
    .trace-hop{color:#fff}
    .trace-latency{color:#ffd93d}
    .trace-target{color:#ff6b6b}
    .typing-cursor{animation:blink 1s infinite}

    /* ——— CTOS NETWORK TRACE MAP ——— */
    #network-trace-overlay{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:3;opacity:0;transition:opacity 1s ease}
    #network-trace-overlay.active{opacity:1}
    
    .trace-map-svg{width:100%;height:100%}
    .satellite-node{fill:#7cff7c;stroke:#fff;stroke-width:1;filter:drop-shadow(0 0 8px #7cff7c)}
    .origin-node{fill:#ff6b6b;stroke:#fff;stroke-width:2;filter:drop-shadow(0 0 12px #ff6b6b)}
    .triangulation-line{stroke:#7cff7c;stroke-width:1.5;fill:none;opacity:0.7;filter:drop-shadow(0 0 4px #7cff7c)}
    .signal-pulse{fill:none;stroke:#7cff7c;stroke-width:2;opacity:0;filter:drop-shadow(0 0 6px #7cff7c)}
    .trace-grid{stroke:#7cff7c;stroke-width:0.3;opacity:0.15}
    
    /* Node Animations */
    .node-pulse{animation:nodePulse 2s ease-in-out infinite}
    .signal-animate{animation:signalTravel 3s linear infinite}
    .triangulate-animate{animation:triangulate 4s ease-in-out infinite}
    
    @keyframes nodePulse{
      0%,100%{r:4;opacity:1}
      50%{r:8;opacity:0.6}
    }
    
    @keyframes signalTravel{
      0%{stroke-dashoffset:100;opacity:0}
      10%{opacity:1}
      90%{opacity:1}
      100%{stroke-dashoffset:0;opacity:0}
    }
    
    @keyframes triangulate{
      0%,100%{opacity:0.3}
      50%{opacity:0.8}
    }

    /* CTOS Status Panel */
    #ctos-status{position:fixed;bottom:20px;right:20px;width:280px;background:rgba(0,20,0,0.95);border:2px solid #7cff7c;border-radius:8px;padding:15px;font-family:'Roboto Mono',monospace;font-size:0.7rem;color:#7cff7c;opacity:0;transition:opacity 0.5s ease;z-index:1003}
    #ctos-status.active{opacity:1}
    .ctos-header{border-bottom:1px solid #7cff7c;margin-bottom:10px;padding-bottom:8px;font-family:'Press Start 2P',monospace;font-size:0.6rem;text-align:center}
    .trace-status{margin:5px 0;display:flex;justify-content:space-between}
    .status-indicator{color:#ff6b6b}
    .status-success{color:#7cff7c}
    .status-warning{color:#ffd93d}
    .triangulation-progress{width:100%;height:4px;background:#333;border-radius:2px;margin:8px 0;overflow:hidden}
    .progress-bar{height:100%;background:linear-gradient(90deg,#ff6b6b,#7cff7c);width:0;transition:width 0.3s ease;border-radius:2px}

    /* Signal Strength Visualization */
    .signal-strength{display:flex;align-items:center;gap:2px;margin:5px 0}
    .signal-bar{width:3px;height:8px;background:#333;border-radius:1px;margin-right:1px}
    .signal-bar.active{background:#7cff7c;box-shadow:0 0 4px #7cff7c}
    .signal-label{margin-right:8px;font-size:0.6rem}
    .location-info{margin-top:8px;font-size:0.6rem;text-align:center;opacity:0.7}

    /* ——— ENCRYPTION STATUS ——— */
    #encryption-status{position:fixed;top:20px;left:20px;padding:10px 15px;background:rgba(0,0,0,0.8);border:1px solid #7cff7c;border-radius:4px;font-family:'Roboto Mono',monospace;font-size:0.8rem;color:#7cff7c;opacity:0;transition:opacity 0.3s;z-index:1000}
    #encryption-status.active{opacity:1}

    /* ——— SYSTEM STATUS HUD ——— */
    #system-hud{position:fixed;top:20px;right:20px;width:200px;background:rgba(0,0,0,0.9);border:1px solid #7cff7c;border-radius:8px;padding:15px;font-family:'Roboto Mono',monospace;font-size:0.7rem;color:#7cff7c;opacity:0.8;z-index:1000}
    .status-item{display:flex;justify-content:space-between;margin:5px 0;padding:2px 0}
    .status-bar{height:4px;background:#333;border-radius:2px;overflow:hidden;margin-left:10px;flex:1}
    .status-fill{height:100%;background:#7cff7c;transition:width 0.5s ease;border-radius:2px}

    /* ——— SCANLINES OVERLAY ——— */
    #scanlines{position:fixed;top:0;left:0;width:100%;height:100%;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(124,255,124,0.03) 2px,rgba(124,255,124,0.03) 4px);pointer-events:none;z-index:5;animation:scanlineMove 0.1s linear infinite}
    @keyframes scanlineMove{0%{transform:translateY(0)}100%{transform:translateY(4px)}}

    /* ——— AI SYSTEM OVERLAY ——— */
    #ai-system{position:fixed;bottom:20px;right:20px;width:300px;max-height:200px;background:rgba(0,20,0,0.9);border:2px solid #7cff7c;border-radius:8px;padding:15px;font-family:'Roboto Mono',monospace;font-size:0.7rem;color:#7cff7c;opacity:0;transition:all 0.3s ease;z-index:1000;overflow-y:auto}
    #ai-system.active{opacity:1}
    .ai-log{margin:3px 0;opacity:0.8}
    .ai-timestamp{color:#666;font-size:0.6rem}

    /* ——— CTOS MAP INTERFACE ——— */
    #ctos-map{position:fixed;top:-100%;left:50%;transform:translateX(-50%);width:90vw;max-width:1200px;height:80vh;background:rgba(0,10,0,0.98);border:3px solid #7cff7c;border-radius:12px;z-index:1005;transition:top 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);overflow:hidden;box-shadow:0 0 50px rgba(124,255,124,0.5)}
    #ctos-map.active{top:10vh}
    .ctos-header{background:linear-gradient(90deg,#0a0a0a,#1a1a1a,#0a0a0a);padding:15px 25px;border-bottom:2px solid #7cff7c;display:flex;justify-content:space-between;align-items:center}
    .ctos-title{color:#7cff7c;font-family:'Press Start 2P',monospace;font-size:1rem;text-shadow:0 0 10px #7cff7c}
    .ctos-close{color:#ff6b6b;cursor:pointer;font-size:1.5rem;padding:5px;transition:all 0.3s ease}
    .ctos-close:hover{color:#fff;transform:scale(1.1)}
    .ctos-map-container{position:relative;width:100%;height:calc(100% - 80px);background:linear-gradient(45deg,#000 25%,transparent 25%),linear-gradient(-45deg,#000 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#000 75%),linear-gradient(-45deg,transparent 75%,#000 75%);background-size:20px 20px;background-position:0 0,0 10px,10px -10px,-10px 0px}
    
    /* Map SVG Grid */
    .map-svg{width:100%;height:100%;position:absolute;top:0;left:0}
    .grid-line{stroke:#7cff7c;stroke-width:0.5;opacity:0.3}
    .user-node{fill:#ff6b6b;stroke:#fff;stroke-width:2;animation:userPulse 2s infinite}
    .random-node{fill:#7cff7c;opacity:0.7;animation:randomPulse 3s infinite}
    .trace-line{stroke:#ff6b6b;stroke-width:2;fill:none;stroke-dasharray:5,5;animation:traceDash 2s linear infinite}
    @keyframes userPulse{0%,100%{r:4;opacity:1}50%{r:8;opacity:0.5}}
    @keyframes randomPulse{0%,100%{opacity:0.7;transform:scale(1)}50%{opacity:0.3;transform:scale(1.3)}}
    @keyframes traceDash{0%{stroke-dashoffset:0}100%{stroke-dashoffset:20}}
    
    /* Map Info Panel */
    .map-info{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(180deg,transparent,rgba(0,0,0,0.9));padding:20px;color:#7cff7c;font-family:'Roboto Mono',monospace;font-size:0.8rem}
    .signal-trace{margin:5px 0;opacity:0;animation:fadeInTrace 0.5s ease forwards}
    .signal-trace:nth-child(1){animation-delay:0.5s}
    .signal-trace:nth-child(2){animation-delay:1s}
    .signal-trace:nth-child(3){animation-delay:1.5s}
    .signal-trace:nth-child(4){animation-delay:2s}
    @keyframes fadeInTrace{to{opacity:1}}
    
    /* Sweep Animation */
    .radar-sweep{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}
    .sweep-line{position:absolute;width:2px;height:100%;background:linear-gradient(180deg,transparent,#7cff7c,transparent);animation:sweep 4s linear infinite;opacity:0.8}
    @keyframes sweep{0%{left:-2px}100%{left:100%}}
    
    /* Glitch Effect for Map */
    .map-glitch{position:absolute;top:0;left:0;width:100%;height:100%;background:transparent;pointer-events:none;opacity:0}
    .map-glitch.active{opacity:1;animation:mapGlitchFlash 0.1s steps(3) 10}
    @keyframes mapGlitchFlash{0%{background:rgba(255,0,0,0.1)}33%{background:rgba(0,255,0,0.1)}66%{background:rgba(0,0,255,0.1)}100%{background:transparent}}

    /* ——— ALERT POPUP ——— */
    .alert-popup{position:fixed;top:100px;left:50%;transform:translateX(-50%);background:rgba(255,0,0,0.9);border:2px solid #ff0000;border-radius:8px;padding:20px;color:#fff;font-family:'Press Start 2P',monospace;font-size:0.8rem;z-index:1003;opacity:0;transition:opacity 0.3s ease;max-width:400px;text-align:center}
    .alert-popup.active{opacity:1}
    .alert-popup::before{content:'⚠️ SECURITY BREACH ⚠️';display:block;margin-bottom:10px;color:#ff6b6b;animation:blink 1s infinite}

    /* ——— CODE SCRAMBLE ANIMATION ——— */
    .scramble{font-family:'Roboto Mono',monospace}
    
    /* ——— HIDDEN CLICKABLE LOGO ——— */
    .logo{cursor:pointer;transition:all 0.3s ease}
    .logo:hover{transform:scale(1.02);text-shadow:0 0 12px #7cff7c}
    
    /* ——— AI SYSTEM STYLES ——— */
    .ai-header{border-bottom:1px solid #7cff7c;margin-bottom:10px;padding-bottom:5px;font-size:0.6rem}
    .alert-subtitle{margin-top:10px;font-size:0.6rem}

    /* ——— ABOUT ——— */
    #about{min-height:80vh;display:flex;flex-direction:column;justify-content:center;padding:6rem 10vw;border-top:1px solid #333;background:linear-gradient(135deg,rgba(0,20,0,0.1),rgba(0,0,20,0.1))}
    #about h2{font-family:'Press Start 2P',monospace;font-size:2rem;margin-bottom:3rem;position:relative;display:inline-block}
    #about h2::after{content:"";position:absolute;left:0;bottom:-.5rem;width:100%;height:4px;background:#7cff7c;box-shadow:0 0 15px #7cff7c}
    
    /* Neon Grid Layout */
    .about-grid{display:grid;grid-template-columns:1fr 1fr;gap:4rem;margin-bottom:4rem}
    .about-left{display:flex;flex-direction:column;gap:1rem}
    .about-right{display:flex;flex-direction:column;gap:2rem}
    
    /* Profile separator lines */
    .profile-separator{font-family:'Roboto Mono',monospace;font-size:0.8rem;color:#7cff7c;text-align:center;margin:2rem 0;opacity:0.6;letter-spacing:0.1em}
    
    /* One-liners with typing effect */
    .cyber-oneliner{font-family:'Press Start 2P',monospace;font-size:0.8rem;color:#7cff7c;text-shadow:0 0 10px rgba(124,255,124,0.5);opacity:0;transform:translateX(-20px);animation:typeIn 0.8s ease forwards;line-height:1.8}
    .cyber-oneliner:nth-child(1){animation-delay:0.5s}
    .cyber-oneliner:nth-child(2){animation-delay:1s}
    .cyber-oneliner:nth-child(3){animation-delay:1.5s}
    .cyber-oneliner:nth-child(4){animation-delay:2s}
    .cyber-oneliner:nth-child(5){animation-delay:2.5s}
    @keyframes typeIn{to{opacity:1;transform:translateX(0)}}
    
    /* Narrative bursts */
    .narrative-burst{font-size:1rem;line-height:1.6;margin-bottom:1.5rem;opacity:0.9}
    .flicker-rule{width:100%;height:2px;background:linear-gradient(90deg,transparent,#7cff7c,transparent);margin:1.5rem 0;animation:flicker 2s infinite}
    
    /* Data-hacker cards */
    .hacker-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:2rem;margin:3rem 0}
    .hacker-card{background:rgba(0,0,0,0.7);border:1px solid #7cff7c;border-radius:8px;padding:1.5rem;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);transition:all 0.3s ease;cursor:pointer;tabindex:0}
    .hacker-card:hover,.hacker-card:focus{transform:translateY(-5px);box-shadow:0 10px 30px rgba(124,255,124,0.3);border-color:#fff}
    .hacker-card h4{font-family:'Press Start 2P',monospace;font-size:0.7rem;color:#7cff7c;margin-bottom:1rem}
    .hacker-card p{font-size:0.85rem;opacity:0.8}
    
    /* Skill bars */
    .skill-bars{margin:3rem 0}
    .skill-bar{margin:1rem 0}
    .skill-label{font-family:'Press Start 2P',monospace;font-size:0.7rem;color:#7cff7c;margin-bottom:0.5rem}
    .skill-track{width:100%;height:8px;background:rgba(0,0,0,0.5);border:1px solid #333;border-radius:4px;overflow:hidden}
    .skill-fill{height:100%;background:linear-gradient(90deg,#7cff7c,#00ff00,#7cff7c);background-size:200% 100%;animation:waveform 2s linear infinite;transition:width 2s ease}
    @keyframes waveform{0%{background-position:200% 0}100%{background-position:-200% 0}}
    
    /* Easter egg terminal */
    .easter-terminal{position:fixed;bottom:20px;right:20px;width:300px;height:120px;background:rgba(0,0,0,0.95);border:1px solid #7cff7c;border-radius:4px;font-family:'Roboto Mono',monospace;font-size:0.8rem;color:#7cff7c;padding:10px;opacity:0;transform:translateY(20px);transition:all 0.5s ease;z-index:1000}
    .easter-terminal.active{opacity:1;transform:translateY(0)}
    .terminal-cursor{animation:blink 1s infinite}
    
    /* Neon Certificate Badges */
    .cert-badges{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:1rem;margin:2rem 0;padding:2rem;background:rgba(0,20,0,0.1);border:1px solid #333;border-radius:8px}
    .cert-badge{position:relative;display:flex;align-items:center;justify-content:center;padding:0.8rem 1rem;background:rgba(0,0,0,0.8);border:2px solid transparent;border-radius:6px;font-family:'Press Start 2P',monospace;font-size:0.6rem;text-align:center;color:#7cff7c;text-shadow:0 0 10px rgba(124,255,124,0.8);cursor:pointer;transition:all 0.3s ease;transform:perspective(1000px)}
    .cert-badge::before{content:"";position:absolute;top:-2px;left:-2px;right:-2px;bottom:-2px;background:linear-gradient(45deg,#7cff7c,#00ff00,#7cff7c,#00ff88);background-size:300% 300%;border-radius:8px;z-index:-1;animation:neonFlow 3s linear infinite;opacity:0;transition:opacity 0.3s ease}
    .cert-badge:hover{transform:perspective(1000px) rotateY(5deg) rotateX(2deg);box-shadow:0 10px 30px rgba(124,255,124,0.3)}
    .cert-badge:hover::before{opacity:1}
    .cert-badge.earned{border-color:#7cff7c;box-shadow:0 0 20px rgba(124,255,124,0.4)}
    .cert-badge.earned::before{opacity:0.8}
    .cert-badge.pursuit{border-color:#ffd700;color:#ffd700;text-shadow:0 0 10px rgba(255,215,0,0.8)}
    .cert-badge.pursuit::before{background:linear-gradient(45deg,#ffd700,#ffed4a,#ffd700,#fff59d);opacity:0.6}
    @keyframes neonFlow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    
    /* Certificate tier headers */
    .cert-tier{font-family:'Press Start 2P',monospace;font-size:0.7rem;color:#7cff7c;margin:2rem 0 1rem 0;text-align:center;position:relative}
    .cert-tier::after{content:"";position:absolute;bottom:-0.5rem;left:50%;transform:translateX(-50%);width:60px;height:2px;background:#7cff7c;box-shadow:0 0 10px #7cff7c}
    
    /* Hex badge grid – lives right under the cert list */
    .badge-rack{
      display:flex; 
      flex-wrap:wrap; 
      gap:18px;
      margin-top:24px;        /* push it under the cert lines */
      max-width:660px;        /* keeps it inside the container */
    }
    
    .cert-svg{
      width:90px;height:90px;
      filter:brightness(1.1);
      background:repeating-linear-gradient(
          0deg,rgba(0,0,0,0) 0 1px,rgba(0,255,0,.10) 1px 3px);
      box-shadow:0 0 10px #7cff7c66;
      border-radius:8px;
      transition:transform .25s ease;
    }
    .cert-svg:hover{transform:scale(1.08) rotate(1deg);}

    /* ============ MAP SECTION ============ */
    #ctos-map{
      margin:80px auto;max-width:1200px;padding:24px;border:2px solid #00ff6b;
      background:rgba(0,15,0,.9);box-shadow:0 0 16px #00ff6b66;
      font-family:'Roboto Mono',monospace;line-height:1.45;letter-spacing:.3px;
    }
    #ctos-map[hidden]{display:none}
    #ctos-map h2{color:#00ff6b;font:700 18px "Press Start 2P",monospace;margin:0 0 12px}
    #map-libre{height:420px;border:1px solid #00ff6b;border-radius:6px}
    #ip-readout{color:#7cff7c;margin:12px 0 0;font-size:13px;white-space:pre-wrap}
    #ctos-map .legal{font-size:11px;color:#888;margin:6px 0 0}

    /* Mobile responsive */
    @media(max-width:768px){
      .about-grid{grid-template-columns:1fr;gap:2rem}
      .hacker-cards{grid-template-columns:1fr;gap:1.5rem}
      .left,.right{width:48%;font-size:.65rem}
      .logo{font-size:12vw}
    }

    /* ——— GOOGLE MAPS CTOS INTEGRATION ——— */
    #ctos-gmap-overlay{position:fixed;top:-100%;left:50%;transform:translateX(-50%);width:95vw;max-width:1400px;height:85vh;background:rgba(0,15,0,0.98);border:3px solid #7cff7c;border-radius:15px;z-index:1006;transition:top 0.8s cubic-bezier(0.25,0.46,0.45,0.94);overflow:hidden;box-shadow:0 0 60px rgba(124,255,124,0.6)}
    #ctos-gmap-overlay.active{top:7.5vh}
    
    .gmap-header{background:linear-gradient(90deg,#0f0f0f,#1f2f1f,#0f0f0f);padding:18px 30px;border-bottom:3px solid #7cff7c;display:flex;justify-content:space-between;align-items:center;position:relative}
    .gmap-header::before{content:'';position:absolute;top:0;left:0;right:0;height:100%;background:repeating-linear-gradient(90deg,transparent,transparent 2px,rgba(124,255,124,0.1) 2px,rgba(124,255,124,0.1) 4px);pointer-events:none}
    
    .gmap-title{color:#7cff7c;font-family:'Press Start 2P',monospace;font-size:1.1rem;text-shadow:0 0 15px #7cff7c;animation:titleGlow 3s ease-in-out infinite}
    @keyframes titleGlow{0%,100%{text-shadow:0 0 15px #7cff7c}50%{text-shadow:0 0 25px #7cff7c,0 0 35px #7cff7c}}
    
    .gmap-close{color:#ff6b6b;cursor:pointer;font-size:1.8rem;padding:8px;transition:all 0.3s ease;border-radius:4px}
    .gmap-close:hover{color:#fff;transform:scale(1.15);background:rgba(255,107,107,0.2)}
    
    .gmap-container{position:relative;width:100%;height:calc(100% - 90px);overflow:hidden;display:flex;flex-direction:column}
    
    /* MapLibre GL Container */
    #cyber-maplibre{width:100%;height:100%;position:relative;z-index:1;flex:1}
    
    /* Google Maps Dark Styling (REMOVED) */
    .gmap-iframe{display:none}
    
    /* Cyberpunk Grid Overlay */
    .cyber-grid-overlay{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:2;background:linear-gradient(rgba(124,255,124,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(124,255,124,0.03) 1px,transparent 1px);background-size:50px 50px;animation:gridPulse 4s ease-in-out infinite}
    @keyframes gridPulse{0%,100%{opacity:0.3}50%{opacity:0.6}}
    
    /* CTOS Node Markers */
    .ctos-node-marker{position:absolute;width:24px;height:24px;border-radius:50%;background:radial-gradient(circle,#ff6b6b,#cc5555);border:3px solid #fff;box-shadow:0 0 20px #ff6b6b,inset 0 0 10px rgba(255,255,255,0.3);animation:ctosNodePulse 2s infinite;z-index:3;cursor:pointer}
    .ctos-node-marker::before{content:'';position:absolute;top:-8px;left:-8px;width:40px;height:40px;border-radius:50%;border:2px solid #ff6b6b;animation:ctosRipple 3s infinite}
    @keyframes ctosNodePulse{0%,100%{transform:scale(1);box-shadow:0 0 20px #ff6b6b}50%{transform:scale(1.1);box-shadow:0 0 30px #ff6b6b,0 0 40px #ff6b6b}}
    @keyframes ctosRipple{0%{transform:scale(0);opacity:1}100%{transform:scale(2);opacity:0}}
    
    .user-location-marker{position:absolute;width:20px;height:20px;border-radius:50%;background:radial-gradient(circle,#7cff7c,#5fcc5f);border:3px solid #fff;box-shadow:0 0 25px #7cff7c;animation:userLocationPulse 1.5s infinite;z-index:3}
    .user-location-marker::before{content:'';position:absolute;top:-10px;left:-10px;width:44px;height:44px;border-radius:50%;border:2px solid #7cff7c;animation:userRipple 2s infinite}
    @keyframes userLocationPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}
    @keyframes userRipple{0%{transform:scale(0);opacity:1}100%{transform:scale(2.5);opacity:0}}
    
    /* Signal Connection Lines */
    .signal-connection{position:absolute;height:2px;background:linear-gradient(90deg,#7cff7c,#ff6b6b,#7cff7c);transform-origin:left center;animation:signalFlow 3s linear infinite;z-index:2;opacity:0.8}
    .signal-connection::before{content:'';position:absolute;top:-1px;left:0;width:100%;height:4px;background:linear-gradient(90deg,transparent,#fff,transparent);animation:signalTraverse 2s linear infinite}
    @keyframes signalFlow{0%,100%{opacity:0.8}50%{opacity:1;box-shadow:0 0 10px #7cff7c}}
    @keyframes signalTraverse{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
    
    /* HUD Interface Panel */
    .gmap-hud{position:absolute;top:20px;left:20px;width:380px;max-height:500px;background:rgba(0,20,0,0.95);border:2px solid #7cff7c;border-radius:10px;padding:20px;font-family:'Roboto Mono',monospace;font-size:0.75rem;color:#7cff7c;z-index:4;overflow-y:auto;backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);box-shadow:0 0 30px rgba(124,255,124,0.3)}
    .hud-header{border-bottom:2px solid #7cff7c;margin-bottom:15px;padding-bottom:10px;font-family:'Press Start 2P',monospace;font-size:0.65rem;text-align:center;color:#fff;text-shadow:0 0 10px #7cff7c}
    .hud-section{margin:12px 0;padding:8px;background:rgba(124,255,124,0.05);border-left:3px solid #7cff7c;border-radius:4px}
    .hud-title{color:#fff;font-weight:bold;margin-bottom:5px;font-size:0.7rem}
    .trace-log{margin:3px 0;opacity:0.9;font-size:0.7rem;animation:fadeInLog 0.5s ease-in-out}
    .log-timestamp{color:#666;font-size:0.6rem;margin-right:8px}
    .log-type{font-weight:bold;margin-right:6px}
    .log-trace{color:#7cff7c}
    .log-geo{color:#ffd93d}
    .log-signal{color:#ff6b6b}
    .log-secure{color:#00ffff}
    .log-ip{color:#ff6b6b;font-family:'Courier New',monospace}
    
    @keyframes fadeInLog{from{opacity:0;transform:translateX(-10px)}to{opacity:0.9;transform:translateX(0)}}
    
    /* IP Trace Display */
    .ip-trace-display{margin:8px 0;padding:10px;background:rgba(0,0,0,0.5);border:1px solid #7cff7c;border-radius:6px;font-family:'Courier New',monospace}
    .ip-address{color:#ff6b6b;font-size:0.8rem;font-weight:bold;margin-bottom:5px}
    .location-data{color:#7cff7c;font-size:0.7rem;margin:2px 0}
    .location-data .label{color:#ffd93d;margin-right:5px}
    .redacted{background:#ff6b6b;color:#ff6b6b;animation:redactedBlink 2s infinite;border-radius:2px;padding:0 2px}
    @keyframes redactedBlink{0%,50%{background:#ff6b6b;color:#ff6b6b}51%,100%{background:transparent;color:#ff6b6b}}
    
    /* Glitch Text Effects */
    .glitch-text{position:relative;display:inline-block}
    .glitch-text::before,.glitch-text::after{content:attr(data-text);position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,20,0,0.95)}
    .glitch-text::before{animation:glitch-1 2s infinite;color:#ff6b6b;z-index:-1}
    .glitch-text::after{animation:glitch-2 3s infinite;color:#00ffff;z-index:-2}
    @keyframes glitch-1{0%,100%{transform:translate(0)}20%{transform:translate(-2px,2px)}40%{transform:translate(-2px,-2px)}60%{transform:translate(2px,2px)}80%{transform:translate(2px,-2px)}}
    @keyframes glitch-2{0%,100%{transform:translate(0)}10%{transform:translate(2px,0)}30%{transform:translate(-1px,0)}50%{transform:translate(1px,0)}70%{transform:translate(-2px,0)}90%{transform:translate(1px,0)}}
    
    /* Portfolio Disclaimer */
    .portfolio-disclaimer{position:absolute;bottom:20px;left:20px;right:20px;background:rgba(0,0,0,0.9);border:1px solid #ffd93d;border-radius:8px;padding:15px;font-family:'Roboto Mono',monospace;font-size:0.65rem;color:#ffd93d;text-align:center;backdrop-filter:blur(3px);-webkit-backdrop-filter:blur(3px);z-index:4}
    .disclaimer-title{font-weight:bold;color:#fff;margin-bottom:8px;font-size:0.7rem}
    .disclaimer-text{line-height:1.4;opacity:0.9}
    
    /* Central Server Node */
    .central-server{position:absolute;width:40px;height:40px;border-radius:50%;background:radial-gradient(circle,#00ffff,#0080ff);border:4px solid #fff;box-shadow:0 0 40px #00ffff,inset 0 0 15px rgba(255,255,255,0.4);animation:serverPulse 1.5s infinite;z-index:3;cursor:pointer}
    .central-server::before{content:'';position:absolute;top:-12px;left:-12px;width:64px;height:64px;border-radius:50%;border:3px solid #00ffff;animation:serverRipple 2.5s infinite}
    .central-server::after{content:'SERVER';position:absolute;top:-30px;left:-15px;font-family:'Press Start 2P',monospace;font-size:0.5rem;color:#00ffff;text-shadow:0 0 8px #00ffff}
    @keyframes serverPulse{0%,100%{transform:scale(1);box-shadow:0 0 40px #00ffff}50%{transform:scale(1.15);box-shadow:0 0 50px #00ffff,0 0 60px #00ffff}}
    @keyframes serverRipple{0%{transform:scale(0);opacity:1}100%{transform:scale(2.5);opacity:0}}
    
    /* Enhanced Signal Lines */
    .signal-line-enhanced{position:absolute;height:3px;background:linear-gradient(90deg,transparent,#7cff7c,#00ffff,#7cff7c,transparent);transform-origin:left center;animation:enhancedSignalFlow 2s linear infinite;z-index:2;opacity:0;border-radius:2px}
    .signal-line-enhanced.active{animation:signalActivate 0.5s ease-in-out forwards,enhancedSignalFlow 2s linear infinite 0.5s}
    @keyframes signalActivate{from{opacity:0;width:0}to{opacity:0.8;width:var(--line-length)}}
    @keyframes enhancedSignalFlow{0%{background:linear-gradient(90deg,transparent,#7cff7c,transparent)}25%{background:linear-gradient(90deg,transparent,#00ffff,#7cff7c,transparent)}50%{background:linear-gradient(90deg,transparent,#ff6b6b,#00ffff,transparent)}75%{background:linear-gradient(90deg,transparent,#7cff7c,#ff6b6b,transparent)}100%{background:linear-gradient(90deg,transparent,#7cff7c,transparent)}}
    
    /* Data Packet Animation */
    .data-packet{position:absolute;width:4px;height:4px;background:#fff;border-radius:50%;box-shadow:0 0 6px #fff;animation:packetTravel 3s linear infinite;z-index:3}
    @keyframes packetTravel{0%{opacity:0;transform:scale(0)}10%{opacity:1;transform:scale(1)}90%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0)}}
    
    /* Loading Animation */
    .trace-loading{display:inline-block;width:12px;height:12px;border:2px solid transparent;border-top:2px solid #7cff7c;border-radius:50%;animation:loading-spin 1s linear infinite;margin-left:5px}
    @keyframes loading-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    
    /* Connection Status Indicators */
    .connection-status{display:flex;align-items:center;margin:8px 0;padding:6px;background:rgba(0,0,0,0.3);border-radius:4px}
    .status-dot{width:8px;height:8px;border-radius:50%;margin-right:10px;animation:statusBlink 2s infinite}
    .status-active{background:#7cff7c;box-shadow:0 0 8px #7cff7c}
    .status-warning{background:#ffd93d;box-shadow:0 0 8px #ffd93d}
    .status-error{background:#ff6b6b;box-shadow:0 0 8px #ff6b6b}
    @keyframes statusBlink{0%,50%{opacity:1}51%,100%{opacity:0.4}}
    
    /* Glitch Effects for Map */
    .gmap-glitch{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:5;opacity:0;background:linear-gradient(45deg,transparent 48%,rgba(255,0,0,0.1) 49%,rgba(255,0,0,0.1) 51%,transparent 52%);animation:mapGlitch 0.1s infinite}
    .gmap-glitch.active{opacity:1}
    @keyframes mapGlitch{0%{transform:translateX(0)}25%{transform:translateX(-2px)}50%{transform:translateX(2px)}75%{transform:translateX(-1px)}100%{transform:translateX(0)}}
    
    /* Mini Radar in Corner */
    .mini-radar{position:absolute;bottom:20px;right:20px;width:120px;height:120px;border-radius:50%;background:radial-gradient(circle,rgba(0,40,0,0.9) 30%,rgba(0,20,0,0.9) 70%);border:2px solid #7cff7c;z-index:4}
    .radar-sweep{position:absolute;top:50%;left:50%;width:2px;height:50px;background:linear-gradient(180deg,#7cff7c,transparent);transform-origin:bottom center;animation:radarSweep 3s linear infinite;margin-left:-1px;margin-top:-50px}
    @keyframes radarSweep{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    .radar-blip{position:absolute;width:4px;height:4px;background:#ff6b6b;border-radius:50%;animation:radarBlip 2s infinite}
    .radar-blip-1{top:30%;left:60%}
    .radar-blip-2{top:70%;left:40%}
    .radar-blip-3{top:50%;left:80%}
    @keyframes radarBlip{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.3;transform:scale(1.5)}}
    
    /* ——— LEAFLET.JS CYBERPUNK MAP ——— */
    #leaflet-cyber-map{position:fixed;top:-100%;left:50%;transform:translateX(-50%);width:95vw;max-width:1400px;height:85vh;background:rgba(0,15,0,0.98);border:3px solid #7cff7c;border-radius:15px;z-index:1007;transition:top 0.8s cubic-bezier(0.25,0.46,0.45,0.94);overflow:hidden;box-shadow:0 0 60px rgba(124,255,124,0.6)}
    #leaflet-cyber-map.active{top:7.5vh}
    
    .leaflet-map-header{background:linear-gradient(90deg,#0f0f0f,#1f2f1f,#0f0f0f);padding:18px 30px;border-bottom:3px solid #7cff7c;display:flex;justify-content:space-between;align-items:center;position:relative}
    .leaflet-map-header::before{content:'';position:absolute;top:0;left:0;right:0;height:100%;background:repeating-linear-gradient(90deg,transparent,transparent 2px,rgba(124,255,124,0.1) 2px,rgba(124,255,124,0.1) 4px);pointer-events:none}
    
    .leaflet-title{color:#7cff7c;font-family:'Press Start 2P',monospace;font-size:1.1rem;text-shadow:0 0 15px #7cff7c;animation:titleGlow 3s ease-in-out infinite}
    .leaflet-close{color:#ff6b6b;cursor:pointer;font-size:1.8rem;padding:8px;transition:all 0.3s ease;border-radius:4px}
    .leaflet-close:hover{color:#fff;transform:scale(1.15);background:rgba(255,107,107,0.2)}
    
    .leaflet-container-wrapper{position:relative;width:100%;height:calc(100% - 90px);overflow:hidden;background:#111712}
    .leaflet-cyber-container{width:100%;height:100%;position:relative;z-index:1;pointer-events:auto}
    
    /* MapLibre GL Custom Cyberpunk Styling */
    .maplibregl-map{background:#111712!important;font-family:'Roboto Mono',monospace!important}
    .maplibregl-canvas{filter:brightness(0.8) contrast(1.3) saturate(0.9)!important}
    
    /* Custom Cyberpunk Markers */
    .cyber-marker{width:20px;height:20px;border-radius:50%;background:radial-gradient(circle,#7cff7c,#5fcc5f);border:3px solid #fff;box-shadow:0 0 25px #7cff7c;animation:cyberMarkerPulse 1.5s infinite;position:relative}
    .cyber-marker::before{content:'';position:absolute;top:-10px;left:-10px;width:44px;height:44px;border-radius:50%;border:2px solid #7cff7c;animation:cyberRipple 2s infinite}
    @keyframes cyberMarkerPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}
    @keyframes cyberRipple{0%{transform:scale(0);opacity:1}100%{transform:scale(2.5);opacity:0}}
    
    .threat-marker{width:24px;height:24px;border-radius:50%;background:radial-gradient(circle,#ff6b6b,#cc5555);border:3px solid #fff;box-shadow:0 0 20px #ff6b6b;animation:threatPulse 2s infinite;position:relative}
    .threat-marker::before{content:'';position:absolute;top:-8px;left:-8px;width:40px;height:40px;border-radius:50%;border:2px solid #ff6b6b;animation:threatRipple 3s infinite}
    @keyframes threatPulse{0%,100%{transform:scale(1);box-shadow:0 0 20px #ff6b6b}50%{transform:scale(1.1);box-shadow:0 0 30px #ff6b6b,0 0 40px #ff6b6b}}
    @keyframes threatRipple{0%{transform:scale(0);opacity:1}100%{transform:scale(2);opacity:0}}
    
    .server-marker{width:28px;height:28px;border-radius:50%;background:radial-gradient(circle,#00ffff,#0080ff);border:4px solid #fff;box-shadow:0 0 30px #00ffff;animation:serverMarkerPulse 1.8s infinite;position:relative}
    .server-marker::before{content:'';position:absolute;top:-10px;left:-10px;width:52px;height:52px;border-radius:50%;border:3px solid #00ffff;animation:serverMarkerRipple 2.5s infinite}
    @keyframes serverMarkerPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}
    @keyframes serverMarkerRipple{0%{transform:scale(0);opacity:1}100%{transform:scale(2.2);opacity:0}}
    
    /* Cyberpunk Grid Overlay for Leaflet */
    .leaflet-cyber-grid{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1000;background:linear-gradient(rgba(124,255,124,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(124,255,124,0.03) 1px,transparent 1px);background-size:50px 50px;animation:cyberGridPulse 4s ease-in-out infinite}
    @keyframes cyberGridPulse{0%,100%{opacity:0.3}50%{opacity:0.6}}
    
    /* Leaflet Control Styling */
    .leaflet-control{background:rgba(0,20,0,0.9)!important;border:1px solid #7cff7c!important;border-radius:4px!important}
    .leaflet-control a{color:#7cff7c!important;background:rgba(0,20,0,0.9)!important;border-color:#7cff7c!important}
    .leaflet-control a:hover{background:rgba(124,255,124,0.2)!important}
    
    /* Custom Popup Styling */
    .leaflet-popup-content-wrapper{background:rgba(0,20,0,0.95)!important;color:#7cff7c!important;border:2px solid #7cff7c!important;border-radius:8px!important;font-family:'Roboto Mono',monospace!important;font-size:0.8rem!important}
    .leaflet-popup-content{margin:12px 16px!important;line-height:1.4!important}
    .leaflet-popup-tip{background:rgba(0,20,0,0.95)!important;border:2px solid #7cff7c!important}
    
    /* Signal Connection Lines for Leaflet */
    .leaflet-signal-line{stroke:#7cff7c;stroke-width:2;fill:none;opacity:0.7;filter:drop-shadow(0 0 4px #7cff7c);animation:leafletSignalPulse 3s linear infinite}
    @keyframes leafletSignalPulse{0%,100%{stroke:#7cff7c;opacity:0.7}50%{stroke:#00ffff;opacity:1}}
    
    /* Leaflet HUD Panel */
    .leaflet-hud{position:absolute;top:20px;left:20px;width:380px;max-height:500px;background:rgba(0,20,0,0.95);border:2px solid #7cff7c;border-radius:10px;padding:20px;font-family:'Roboto Mono',monospace;font-size:0.75rem;color:#7cff7c;z-index:1001;overflow-y:auto;backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);box-shadow:0 0 30px rgba(124,255,124,0.3)}
    
    /* Threat Level Indicator */
    .threat-level{position:absolute;top:20px;right:20px;width:200px;background:rgba(20,0,0,0.95);border:2px solid #ff6b6b;border-radius:10px;padding:15px;font-family:'Press Start 2P',monospace;font-size:0.6rem;color:#ff6b6b;z-index:1001;text-align:center}
    .threat-bar{width:100%;height:8px;background:#333;border-radius:4px;margin:10px 0;overflow:hidden}
    .threat-fill{height:100%;background:linear-gradient(90deg,#7cff7c,#ffd93d,#ff6b6b);transition:width 1s ease;border-radius:4px;animation:threatBarPulse 2s ease-in-out infinite;width:45%}
    @keyframes threatBarPulse{0%,100%{box-shadow:0 0 5px rgba(255,107,107,0.5)}50%{box-shadow:0 0 15px rgba(255,107,107,0.8)}}
    
    /* MapLibre GL Popup Styling */
    .maplibregl-popup-content{background:#000!important;border:1px solid #7cff7c!important;border-radius:4px!important;font-family:'Roboto Mono',monospace!important}
    .maplibregl-popup-tip{border-top-color:#7cff7c!important}
    .maplibregl-popup-close-button{color:#ff6b6b!important;font-size:16px!important;font-weight:bold!important}
    .maplibregl-popup-close-button:hover{color:#fff!important}
  </style>
</head>
<body>
  <!-- ——— HERO ——— -->
  <header id="hero">
    <!-- Left stream (two for seamless loop) -->
    <pre id="left1"  class="code-layer left"></pre>
    <pre id="left2"  class="code-layer left offset"></pre>
    <!-- Right stream -->
    <pre id="right1" class="code-layer right"></pre>
    <pre id="right2" class="code-layer right offset"></pre>

    <h1 class="logo scramble" data-text="EADSPACE" onclick="accessSecretVault()">EADSPACE</h1>

    <div id="output"></div>
  </header>

  <!-- ——— ADVANCED UI ELEMENTS ——— -->
  <div id="terminal">
    <div class="terminal-header">
      <span class="terminal-title">EADSPACE_TERMINAL v2.1.7</span>
      <span class="terminal-close" onclick="closeTerminal()">&times;</span>
    </div>
    <div class="terminal-body" id="terminal-content"></div>
  </div>

  <div id="fingerprint">
    <div class="fp-scanner">
      <div class="fp-lines">
        <div class="fp-line"></div>
        <div class="fp-line"></div>
        <div class="fp-line"></div>
      </div>
    </div>
  </div>

  <div id="datastream">
    <div class="stream-header">DATA_STREAM</div>
    <div class="stream-content" id="stream-content"></div>
  </div>

  <div id="access-panel">
    <div class="panel-header">SECURITY_BYPASS</div>
    <div class="security-grid" id="security-grid"></div>
  </div>

  <div id="matrix"></div>
  <div class="glitch-overlay" id="glitch-overlay"></div>
  <div id="encryption-status">🔒 ENCRYPTION: AES-256</div>
  
  <!-- CTOS Google Maps Integration -->
  <div id="ctos-gmap-overlay">
    <div class="gmap-header">
      <div class="gmap-title">CTOS GEOLOCATION MATRIX</div>
      <div class="gmap-close" onclick="closeCTOSGoogleMap()">&times;</div>
    </div>
    <div class="gmap-container">
      <div id="cyber-maplibre"></div>
      <div class="cyber-grid-overlay"></div>
      <div class="gmap-glitch" id="map-glitch"></div>
      
      <!-- HUD Interface -->
      <div class="gmap-hud">
        <div class="hud-header">SIGNAL INTELLIGENCE</div>
        
        <div class="hud-section">
          <div class="hud-title">CONNECTION STATUS</div>
          <div class="connection-status">
            <div class="status-dot status-active"></div>
            <span>CTOS Node Active</span>
          </div>
          <div class="connection-status">
            <div class="status-dot status-warning" id="geo-status"></div>
            <span>Geolocation Lock</span>
          </div>
          <div class="connection-status">
            <div class="status-dot status-error" id="signal-status"></div>
            <span>Signal Trace</span>
          </div>
        </div>
        
        <div class="hud-section">
          <div class="hud-title">IP TRACE ANALYSIS</div>
          <div id="ip-trace-display" class="ip-trace-display">
            <div class="ip-address">
              <span class="glitch-text" data-text="ACQUIRING...">ACQUIRING...</span>
            </div>
            <div class="location-data">
              <span class="label">CITY:</span><span id="trace-city">---</span>
            </div>
            <div class="location-data">
              <span class="label">REGION:</span><span id="trace-region">---</span>
            </div>
            <div class="location-data">
              <span class="label">ISP:</span><span id="trace-isp" class="redacted">CLASSIFIED</span>
            </div>
            <div class="location-data">
              <span class="label">COORDS:</span><span id="trace-coords">---</span>
            </div>
          </div>
        </div>
        
        <div class="hud-section">
          <div class="hud-title">TRACE LOG</div>
          <div id="trace-log-container">
            <!-- Dynamic trace logs will be added here -->
          </div>
        </div>
      </div>
      
      <!-- Central Server Node -->
      <div class="central-server" id="central-server" onclick="triggerServerPulse()"></div>
      
      <!-- ⚠  PORTFOLIO DEMONSTRATION - REMOVED
      <div class="portfolio-disclaimer">
        <div class="disclaimer-title">⚠ PORTFOLIO DEMONSTRATION</div>
        <div class="disclaimer-text">
          Location based on public IP geolocation; approximate city-level data for visual effect only.<br>
          No personal data is collected, stored, or transmitted. This is a cybersecurity-themed portfolio showcase.
        </div>
      </div>
      -->
      
      <!-- Mini Radar -->
      <div class="mini-radar">
        <div class="radar-sweep"></div>
        <div class="radar-blip radar-blip-1"></div>
        <div class="radar-blip radar-blip-2"></div>
        <div class="radar-blip radar-blip-3"></div>
      </div>
    </div>
  </div>

  <!-- Leaflet.js Cyberpunk Map -->
  <div id="leaflet-cyber-map">
    <div class="leaflet-map-header">
      <div class="leaflet-title">LEAFLET CYBER SURVEILLANCE</div>
      <div class="leaflet-close" onclick="closeLeafletCyberMap()">&times;</div>
    </div>
    <div class="leaflet-container-wrapper">
      <div id="leaflet-cyber-container" class="leaflet-cyber-container"></div>
      <div class="leaflet-cyber-grid"></div>
      
      <!-- Leaflet HUD -->
      <div class="leaflet-hud">
        <div class="hud-header">LEAFLET INTELLIGENCE SYSTEM</div>
        
        <div class="hud-section">
          <div class="hud-title">MAP LAYERS</div>
          <div class="connection-status">
            <div class="status-dot status-active"></div>
            <span>Dark Matter Base Layer</span>
          </div>
          <div class="connection-status">
            <div class="status-dot status-active"></div>
            <span>Cyberpunk Grid Overlay</span>
          </div>
          <div class="connection-status">
            <div class="status-dot status-warning" id="leaflet-markers-status"></div>
            <span>Threat Markers</span>
          </div>
        </div>
        
        <div class="hud-section">
          <div class="hud-title">IP TRACE DATA</div>
          <div id="leaflet-trace-display" class="ip-trace-display">
            <div class="ip-address">
              <span class="glitch-text" data-text="SCANNING...">SCANNING...</span>
            </div>
            <div class="location-data">
              <span class="label">TARGET:</span><span id="leaflet-target-city">---</span>
            </div>
            <div class="location-data">
              <span class="label">NETWORK:</span><span id="leaflet-target-isp" class="redacted">ENCRYPTED</span>
            </div>
            <div class="location-data">
              <span class="label">COORDS:</span><span id="leaflet-target-coords">---</span>
            </div>
          </div>
        </div>
        
        <div class="hud-section">
          <div class="hud-title">SURVEILLANCE LOG</div>
          <div id="leaflet-trace-log">
            <!-- Dynamic logs will be added here -->
          </div>
        </div>
      </div>
      
      <!-- Threat Level Indicator -->
      <div class="threat-level">
        <div>THREAT LEVEL</div>
        <div class="threat-bar">
          <div class="threat-fill" id="threat-fill"></div>
        </div>
        <div id="threat-status">MODERATE</div>
      </div>
    </div>
  </div>

  <!-- ——— CTOS NETWORK TRACE OVERLAY ——— -->
  <div id="network-trace-overlay">
    <svg class="trace-map-svg" id="trace-svg" viewBox="0 0 1920 1080">
      <!-- Background Grid -->
      <defs>
        <pattern id="trace-grid" width="60" height="60" patternUnits="userSpaceOnUse">
          <path d="M 60 0 L 0 0 0 60" class="trace-grid"/>
        </pattern>
        <filter id="glow">
          <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
          <feMerge>
            <feMergeNode in="coloredBlur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>
      <rect width="100%" height="100%" fill="url(#trace-grid)"/>
      
      <!-- Signal Lines Group -->
      <g id="signal-lines"></g>
      
      <!-- Triangulation Lines Group -->
      <g id="triangulation-lines"></g>
      
      <!-- Satellite Nodes Group -->
      <g id="satellite-nodes"></g>
      
      <!-- Origin Node Group -->
      <g id="origin-node"></g>
    </svg>
  </div>
  
  <!-- ——— CTOS STATUS PANEL ——— -->
  <div id="ctos-status">
    <div class="ctos-header">NETWORK_TRACE_v4.7</div>
    <div class="trace-status">
      <span>Signal Origin:</span>
      <span class="status-indicator" id="origin-status">SCANNING...</span>
    </div>
    <div class="trace-status">
      <span>Satellites:</span>
      <span class="status-success" id="satellite-count">0/8</span>
    </div>
    <div class="trace-status">
      <span>Triangulation:</span>
      <span class="status-warning" id="triangulation-status">IN PROGRESS</span>
    </div>
    <div class="triangulation-progress">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
    <div class="signal-strength">
      <span class="signal-label">SIGNAL:</span>
      <div class="signal-bar" id="bar1"></div>
      <div class="signal-bar" id="bar2"></div>
      <div class="signal-bar" id="bar3"></div>
      <div class="signal-bar" id="bar4"></div>
      <div class="signal-bar" id="bar5"></div>
    </div>
    <div class="location-info" id="location-info">
      Resolving coordinates...
    </div>
  </div>
  
  <!-- ——— ENHANCED UI ELEMENTS ——— -->
  <div id="scanlines"></div>
  <div id="world-map">
    <svg class="world-map-svg" viewBox="0 0 1000 500">
      <!-- Grid lines -->
      <defs>
        <pattern id="world-grid" width="50" height="25" patternUnits="userSpaceOnUse">
          <path d="M 50 0 L 0 0 0 25" class="grid-overlay"/>
        </pattern>
      </defs>
      <rect width="100%" height="100%" fill="url(#world-grid)"/>
      
      <!-- Simplified world continents -->
      <!-- North America -->
      <path d="M150 100 Q200 80 250 90 L300 95 Q350 100 380 120 L350 180 Q300 200 250 190 L200 185 Q150 170 120 140 Z" class="continent"/>
      
      <!-- South America -->
      <path d="M220 220 Q250 210 280 230 L290 280 Q285 320 270 350 L260 380 Q240 390 220 380 L210 350 Q200 320 205 280 L210 240 Z" class="continent"/>
      
      <!-- Europe -->
      <path d="M450 80 Q480 75 510 85 L530 90 Q550 95 560 110 L555 130 Q540 140 520 135 L500 130 Q470 125 450 115 Z" class="continent"/>
      
      <!-- Africa -->
      <path d="M480 150 Q520 140 550 160 L570 200 Q575 250 570 300 L565 350 Q550 380 530 370 L510 360 Q490 340 485 300 L480 250 Q475 200 480 150 Z" class="continent"/>
      
      <!-- Asia -->
      <path d="M580 70 Q650 60 720 80 L780 90 Q820 100 850 120 L840 160 Q800 180 750 170 L700 165 Q650 155 600 145 L580 120 Z" class="continent"/>
      
      <!-- Australia -->
      <path d="M750 300 Q780 295 810 305 L830 315 Q840 325 835 340 L825 350 Q800 355 775 350 L760 345 Q750 335 750 320 Z" class="continent"/>
      
      <!-- Connection lines for visual effect -->
      <line x1="100" y1="100" x2="900" y2="100" class="country-border"/>
      <line x1="100" y1="200" x2="900" y2="200" class="country-border"/>
      <line x1="100" y1="300" x2="900" y2="300" class="country-border"/>
      <line x1="100" y1="400" x2="900" y2="400" class="country-border"/>
      
      <line x1="200" y1="50" x2="200" y2="450" class="country-border"/>
      <line x1="400" y1="50" x2="400" y2="450" class="country-border"/>
      <line x1="600" y1="50" x2="600" y2="450" class="country-border"/>
      <line x1="800" y1="50" x2="800" y2="450" class="country-border"/>
    </svg>
  </div>
  
  <div id="traceroute-terminal">
    <div id="traceroute-content"></div>
  </div>
  
  <div id="system-hud">
    <div class="status-item">
      <span>CPU:</span>
      <div class="status-bar"><div class="status-fill" id="cpu-bar"></div></div>
      <span id="cpu-text">0%</span>
    </div>
    <div class="status-item">
      <span>MEM:</span>
      <div class="status-bar"><div class="status-fill" id="mem-bar"></div></div>
      <span id="mem-text">0%</span>
    </div>
    <div class="status-item">
      <span>NET:</span>
      <div class="status-bar"><div class="status-fill" id="net-bar"></div></div>
      <span id="net-text">0%</span>
    </div>
    <div class="status-item">
      <span>UPTIME:</span>
      <span id="uptime">00:00:00</span>
    </div>
  </div>

  <div id="ai-system">
    <div class="ai-header">
      AI_NEXUS v3.7.2
    </div>
    <div id="ai-logs"></div>
  </div>

  <div class="alert-popup" id="alert-popup">
    <div>Unauthorized access detected!</div>
    <div class="alert-subtitle">Initiating countermeasures...</div>
  </div>

  <!-- ——— CTOS MAP INTERFACE ——— -->
  <div id="ctos-map">
    <div class="ctos-header">
      <div class="ctos-title">CTOS_SIGNAL_TRACE v4.2.1</div>
      <div class="ctos-close" onclick="closeCTOSMap()">&times;</div>
    </div>
    <div class="ctos-map-container">
      <svg class="map-svg" id="map-svg" viewBox="0 0 1000 600">
        <!-- Grid Lines -->
        <defs>
          <pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse">
            <path d="M 50 0 L 0 0 0 50" class="grid-line"/>
          </pattern>
        </defs>
        <rect width="100%" height="100%" fill="url(#grid)" opacity="0.3"/>
        
        <!-- Trace Lines will be dynamically added -->
        <g id="trace-lines"></g>
        
        <!-- Network Nodes will be dynamically added -->
        <g id="network-nodes"></g>
        
        <!-- User Location will be dynamically added -->
        <g id="user-location"></g>
      </svg>
      
      <div class="radar-sweep">
        <div class="sweep-line"></div>
      </div>
      
      <div class="map-glitch" id="map-glitch"></div>
      
      <div class="map-info" id="map-info">
        <div class="signal-trace">[CTOS] Initializing signal intercept...</div>
        <div class="signal-trace">[SCAN] Triangulating origin coordinates...</div>
        <div class="signal-trace" id="location-trace">[TRACE] Signal received from: --</div>
        <div class="signal-trace" id="geo-trace">[GEO] Location: Unknown | ISP: --</div>
      </div>
    </div>
  </div>

  <!-- ——— ABOUT ——— -->
  <section id="about">
    <h2>NEURAL_PROFILE.exe</h2>
    <div class="profile-separator">──────────────────</div>
    
    <div class="about-grid">
      <div class="about-left">
        <div class="cyber-oneliner">NETWORK ENGINEER · PACKET ANALYST</div>
        <div class="cyber-oneliner">CLOUD ARCHITECT · SOC DESIGNER</div>
        <div class="cyber-oneliner">CEH · CCNP · WCNA · AZ‑900 · AZ‑800</div>
        <div class="cyber-oneliner">SEC+ · ITIL · Oracle Database Admin</div>
        
        <!-- 🚩 Badge rack positioned right under cert text -->
        <div class="badge-rack" id="badge-rack"></div>
      </div>
      
      <div class="about-right">
        <div class="narrative-burst">
          I design resilient networks and streamline log pipelines. From core Cisco switching to Kubernetes clusters, my job is to keep latency low, uptime consistent, and evidence clear.
        </div>
        <div class="flicker-rule"></div>
        <div class="narrative-burst">
          I automate with Python, inspect with Wireshark, and harden cloud workloads so outages become footnotes, not headlines.
        </div>
        <div class="flicker-rule"></div>
        <div class="narrative-burst">
          Next up: CISSP. Side project: teaching AI models to flag misconfigurations before they hit production.
        </div>
      </div>
    </div>
    
    <div class="profile-separator">──────────────────────────────────</div>
    
    <div class="hacker-cards">
      <div class="hacker-card" tabindex="0">
        <h4>NETWORK_OPS</h4>
        <p>CCNP • WCNA certified network architect specializing in enterprise switching, routing protocols, and SD-WAN implementations across hybrid cloud environments.</p>
      </div>
      <div class="hacker-card" tabindex="0">
        <h4>CLOUD_FORGE</h4>
        <p>Azure certified cloud engineer with Docker/Kubernetes expertise, building scalable container orchestration for mission-critical workloads.</p>
      </div>
      <div class="hacker-card" tabindex="0">
        <h4>CYBER_DEFENSE</h4>
        <p>CEH certified ethical hacker and SOC analyst, designing security frameworks that anticipate threat vectors before they materialize into incidents.</p>
      </div>
    </div>
    
    <div class="skill-bars">
      <div class="skill-bar">
        <div class="skill-label">NETWORK ENGINEERING</div>
        <div class="skill-track"><div class="skill-fill" style="width:95%"></div></div>
      </div>
      <div class="skill-bar">
        <div class="skill-label">CLOUD ARCHITECTURE</div>
        <div class="skill-track"><div class="skill-fill" style="width:90%"></div></div>
      </div>
      <div class="skill-bar">
        <div class="skill-label">CYBERSECURITY</div>
        <div class="skill-track"><div class="skill-fill" style="width:88%"></div></div>
      </div>
      <div class="skill-bar">
        <div class="skill-label">LOG PIPELINE AUTOMATION</div>
        <div class="skill-track"><div class="skill-fill" style="width:85%"></div></div>
      </div>
    </div>
    
    <div class="cert-tier">EARNED CERTIFICATIONS</div>
    <div class="cert-badges">
      <div class="cert-badge earned" title="Certified Ethical Hacker">CEH</div>
      <div class="cert-badge earned" title="CCNP Enterprise">CCNP</div>
      <div class="cert-badge earned" title="Wireshark Certified Network Analyst">WCNA</div>
      <div class="cert-badge earned" title="Azure Fundamentals">AZ-900</div>
      <div class="cert-badge earned" title="Azure Server Infrastructure">AZ-800</div>
      <div class="cert-badge earned" title="CompTIA Security+">SEC+</div>
      <div class="cert-badge earned" title="ITIL Foundation">ITIL</div>
      <div class="cert-badge earned" title="Oracle Database Administrator">OCP DBA</div>
    </div>
    
    <div class="cert-tier">CURRENT PURSUIT</div>
    <div class="cert-badges">
      <div class="cert-badge pursuit" title="Certified Information Systems Security Professional">CISSP</div>
    </div>
    
    <div class="cert-tier">ROADMAP TARGETS</div>
    <div class="cert-badges">
      <div class="cert-badge" title="Offensive Security Certified Professional">OSCP</div>
      <div class="cert-badge" title="AWS Solutions Architect Professional">AWS SAA</div>
      <div class="cert-badge" title="Certified Kubernetes Administrator">CKA</div>
    </div>
    
    <div class="easter-terminal" id="easter-terminal">
      <div>$ whoami</div>
      <div>phantom_packet_smith</div>
      <div>$ status</div>
      <div>SIEM evasion protocols: <span class="terminal-cursor">█</span></div>
    </div>
  </section>

  <script>
    /* ——— CODE STREAM GENERATION ——— */
    const snippets=[
      "gpg --encrypt --recipient hack@ead.space secrets.txt",
      "nmap -sV -p- ead.space",
      "docker compose up -d edge_channel",
      "python exploit.py --target 192.168.0.8",
      "SELECT * FROM users WHERE role='admin'; --",
      "curl -X POST https://ead.space/api/x0feed --data '{\"ping\":true}'",
      "iptables -A OUTPUT -p tcp --dport 443 -j ACCEPT",
      "sudo ./radar --interface wlan0 --inject",
      "const seed = crypto.randomUUID();",
      "tasklist | findstr /i \"ctOS\"",
      "ssh -i ~/.ssh/id_rsa root@darknet.onion",
      "openssl rand -hex 32 | tee session.key",
      "wireshark -i eth0 -f 'tcp port 443'",
      "hashcat -m 2500 handshake.cap wordlist.txt",
      "metasploit> use exploit/multi/handler",
      "nc -lvnp 4444",
      "python -c 'import pty; pty.spawn(\"/bin/bash\")'",
      "grep -r 'password' /var/log/",
      "find / -perm -4000 2>/dev/null",
      "cat /proc/version | grep -i kernel",
      "hydra -l admin -P passwords.txt ssh://target",
      "john --wordlist=rockyou.txt hashes.txt",
      "sqlmap -u 'http://target/page.php?id=1' --dbs",
      "aircrack-ng -w wordlist.txt capture.cap",
      "beef-xss",
      "msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f exe > payload.exe"
    ];

    function generateBlock(lines=800){return Array.from({length:lines},()=>snippets[Math.random()*snippets.length|0]).join(`\n`)}

    // Get references to the column elements (keeping the 2-column layout structure)
    const left1 = document.getElementById('left1');
    const left2 = document.getElementById('left2');
    const right1 = document.getElementById('right1');
    const right2 = document.getElementById('right2');

    // populate left & right columns
    left1.textContent  = generateBlock();
    left2.textContent  = generateBlock();
    right1.textContent = generateBlock();
    right2.textContent = generateBlock();

    /* ——— FAKE OUTPUT ROTATION ——— */
    const opDiv=document.getElementById('output');
    // Fake output rotation removed
    
    /* ——— ENVIRONMENT SCANNER ——— */
    const envData = {
      platform: navigator.platform,
      userAgent: navigator.userAgent,
      language: navigator.language,
      cookieEnabled: navigator.cookieEnabled,
      onLine: navigator.onLine,
      screen: `${screen.width}x${screen.height}`,
      colorDepth: screen.colorDepth,
      timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
      memory: navigator.deviceMemory || 'unknown',
      cores: navigator.hardwareConcurrency || 'unknown',
      connection: navigator.connection?.effectiveType || 'unknown'
    };

    /* ——— HIDDEN COMMAND INTERFACE ——— */
    let keySequence = '';
    const triggerSequence = 'eadspace';
    
    document.addEventListener('keydown', (e) => {
      keySequence += e.key.toLowerCase();
      if (keySequence.length > triggerSequence.length) {
        keySequence = keySequence.slice(-triggerSequence.length);
      }
      
      if (keySequence === triggerSequence) {
        executeHiddenCommands();
        keySequence = '';
      }
    });
    
    function executeHiddenCommands() {
      // Hidden functions that can be triggered silently
      console.log('%c[HIDDEN] System Access Granted', 'color: #7cff7c; font-weight: bold;');
      console.log('Environment Data:', envData);
      
      // Add glitch effect temporarily
      document.querySelector('.logo').style.animation = 'glitch 0.1s steps(2,end) infinite, flicker 3s infinite';
      setTimeout(() => {
        document.querySelector('.logo').style.animation = 'flicker 3s infinite';
      }, 1000);
    }

    /* ——— ADVANCED HACKING SIMULATION ——— */
    
    // Terminal Interface
    let terminalLines = [];
    const maxTerminalLines = 50;
    
    function openTerminal() {
      document.getElementById('terminal').classList.add('active');
      simulateHackingSession();
    }
    
    function closeTerminal() {
      document.getElementById('terminal').classList.remove('active');
    }
    
    function addTerminalLine(text, type = 'output') {
      const line = document.createElement('div');
      line.className = `terminal-line ${type}`;
      if (type === 'prompt') {
        line.innerHTML = `<span class="terminal-prompt">root@eadspace:~#</span> ${text}`;
      } else {
        line.textContent = text;
      }
      
      const content = document.getElementById('terminal-content');
      content.appendChild(line);
      
      if (terminalLines.length >= maxTerminalLines) {
        content.removeChild(content.firstChild);
      }
      
      content.scrollTop = content.scrollHeight;
    }
    
    function simulateHackingSession() {
      const hackCommands = [
        { cmd: "nmap -sS -O target.corp.com", responses: ["Starting Nmap scan...", "Host is up (0.0034s latency)", "PORT     STATE SERVICE", "22/tcp   open  ssh", "80/tcp   open  http", "443/tcp  open  https"] },
        { cmd: "python exploit.py --target target.corp.com", responses: ["[*] Initializing exploit framework", "[+] Target acquired: target.corp.com", "[*] Scanning for vulnerabilities...", "[!] CVE-2023-4567 detected", "[+] Exploitation successful!"] },
        { cmd: "ssh root@target.corp.com", responses: ["Warning: Permanently added 'target.corp.com' to known hosts", "root@target.corp.com's password:", "[Authentication successful]", "Welcome to Ubuntu 20.04.3 LTS"] },
        { cmd: "cat /etc/shadow | grep root", responses: ["root:$6$xyz123$hashvalue:18756:0:99999:7:::"] }
      ];
      
      let commandIndex = 0;
      function executeNextCommand() {
        if (commandIndex >= hackCommands.length) return;
        
        const { cmd, responses } = hackCommands[commandIndex];
        addTerminalLine(cmd, 'prompt');
        
        responses.forEach((response, index) => {
          setTimeout(() => {
            addTerminalLine(response);
            if (index === responses.length - 1) {
              setTimeout(() => {
                commandIndex++;
                if (commandIndex < hackCommands.length) {
                  executeNextCommand();
                } else {
                  addTerminalLine('root@target:~# <span class="terminal-cursor">█</span>', 'prompt');
                }
              }, 800);
            }
          }, (index + 1) * 600);
        });
      }
      
      setTimeout(executeNextCommand, 500);
    }

    // Matrix Rain Effect
    function createMatrixRain() {
      const matrix = document.getElementById('matrix');
      const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()_+-=[]{}|;:,.<>?';
      
      for (let i = 0; i < 50; i++) {
        setTimeout(() => {
          const column = document.createElement('div');
          column.className = 'matrix-column';
          column.style.left = Math.random() * 100 + 'vw';
          column.style.animationDuration = (Math.random() * 3 + 2) + 's';
          column.style.animationDelay = Math.random() * 2 + 's';
          
          let text = '';
          for (let j = 0; j < 20; j++) {
            text += characters[Math.floor(Math.random() * characters.length)] + '\n';
          }
          column.textContent = text;
          
          matrix.appendChild(column);
          
          setTimeout(() => {
            if (column.parentNode) column.parentNode.removeChild(column);
          }, 8000);
        }, i * 200);
      }
    }

    // Data Stream Simulation
    function updateDataStream() {
      const streamContent = document.getElementById('stream-content');
      const dataTypes = [
        { type: 'IP_TRACE', data: () => `${Math.floor(Math.random()*256)}.${Math.floor(Math.random()*256)}.${Math.floor(Math.random()*256)}.${Math.floor(Math.random()*256)}` },
        { type: 'PKT_SNIFF', data: () => `TCP:${Math.floor(Math.random()*65535)}→443` },
        { type: 'SQL_INJECT', data: () => `UNION SELECT ${Math.floor(Math.random()*100)} FROM users` },
        { type: 'CRYPTO_KEY', data: () => Array.from({length:16}, () => Math.floor(Math.random()*16).toString(16)).join('').toUpperCase() },
        { type: 'GEOLOC', data: () => `${(Math.random()*180-90).toFixed(4)},${(Math.random()*360-180).toFixed(4)}` }
      ];
      
      setInterval(() => {
        const packet = dataTypes[Math.floor(Math.random() * dataTypes.length)];
        const div = document.createElement('div');
        div.className = 'data-packet';
        div.innerHTML = `<strong>${packet.type}:</strong><br>${packet.data()}`;
        streamContent.appendChild(div);
        
        if (streamContent.children.length > 30) {
          streamContent.removeChild(streamContent.firstChild);
        }
        streamContent.scrollTop = streamContent.scrollHeight;
      }, 1500);
    }

    // Security Grid Bypass
    function initSecurityGrid() {
      const grid = document.getElementById('security-grid');
      const sequence = [0, 2, 4, 6, 8, 1, 3, 5, 7];
      let currentStep = 0;
      
      for (let i = 0; i < 9; i++) {
        const node = document.createElement('div');
        node.className = 'security-node';
        node.textContent = (i + 1).toString(16).toUpperCase();
        node.addEventListener('click', () => {
          if (i === sequence[currentStep]) {
            node.classList.add('active');
            currentStep++;
            if (currentStep === sequence.length) {
              setTimeout(() => {
                triggerSystemBreach();
              }, 500);
            }
          } else {
            resetSecurityGrid();
          }
        });
        grid.appendChild(node);
      }
    }
    
    function resetSecurityGrid() {
      document.querySelectorAll('.security-node').forEach(node => {
        node.classList.remove('active');
      });
      currentStep = 0;
    }
    
    function triggerSystemBreach() {
      document.getElementById('access-panel').classList.remove('active');
      document.getElementById('glitch-overlay').classList.add('active');
      
      setTimeout(() => {
        document.getElementById('glitch-overlay').classList.remove('active');
        openTerminal();
      }, 2000);
      
      resetSecurityGrid();
    }

    // Fingerprint Scanner
    function activateFingerprintScanner() {
      const fp = document.getElementById('fingerprint');
      fp.classList.add('active');
      
      setTimeout(() => {
        fp.style.background = 'radial-gradient(circle, rgba(255,107,107,0.3) 30%, transparent 70%)';
        setTimeout(() => {
          fp.style.background = 'radial-gradient(circle, rgba(124,255,124,0.3) 30%, transparent 70%)';
          setTimeout(() => {
            fp.classList.remove('active');
            document.getElementById('datastream').classList.add('active');
          }, 1000);
        }, 1500);
      }, 2000);
    }

    // Advanced Key Sequences
    const keySequences = {
      'hack': () => {
        document.getElementById('access-panel').classList.add('active');
      },
      'matrix': () => {
        createMatrixRain();
      },
      'scan': () => {
        activateFingerprintScanner();
      },
      'breach': () => {
        openTerminal();
      },
      'encrypt': () => {
        document.getElementById('encryption-status').classList.add('active');
        setTimeout(() => {
          document.getElementById('encryption-status').classList.remove('active');
        }, 3000);
      }
    };

    // Enhanced Key Sequence Detection
    let currentSequence = '';
    document.addEventListener('keydown', (e) => {
      currentSequence += e.key.toLowerCase();
      
      // Check all sequences
      Object.keys(keySequences).forEach(sequence => {
        if (currentSequence.endsWith(sequence)) {
          keySequences[sequence]();
          currentSequence = '';
        }
      });
      
      // Keep sequence length manageable
      if (currentSequence.length > 20) {
        currentSequence = currentSequence.slice(-10);
      }
      
      // Original eadspace sequence
      if (currentSequence.endsWith('eadspace')) {
        executeHiddenCommands();
        currentSequence = '';
      }
    });

    // Initialize Advanced Features
    updateDataStream();
    initSecurityGrid();
    initSystemHUD();
    initAISystem();
    initMapOverlay();
    initCodeScramble();
    
    // Auto-trigger some effects for ambiance
    setTimeout(() => {
      if (Math.random() > 0.5) createMatrixRain();
    }, 5000);
    
    setTimeout(() => {
      document.getElementById('encryption-status').classList.add('active');
      setTimeout(() => {
        document.getElementById('encryption-status').classList.remove('active');
      }, 2000);
    }, 8000);

    /* ——— ENHANCED SYSTEM FEATURES ——— */
    
    // System HUD with Live Stats
    function initSystemHUD() {
      const startTime = Date.now();
      
      setInterval(() => {
        // CPU Usage Simulation
        const cpu = Math.floor(Math.random() * 30 + 45);
        document.getElementById('cpu-bar').style.width = cpu + '%';
        document.getElementById('cpu-text').textContent = cpu + '%';
        
        // Memory Usage
        const mem = Math.floor(Math.random() * 25 + 60);
        document.getElementById('mem-bar').style.width = mem + '%';
        document.getElementById('mem-text').textContent = mem + '%';
        
        // Network Usage
        const net = Math.floor(Math.random() * 40 + 20);
        document.getElementById('net-bar').style.width = net + '%';
        document.getElementById('net-text').textContent = net + '%';
        
        // Uptime Counter
        const uptime = Math.floor((Date.now() - startTime) / 1000);
        const hours = String(Math.floor(uptime / 3600)).padStart(2, '0');
        const minutes = String(Math.floor((uptime % 3600) / 60)).padStart(2, '0');
        const seconds = String(uptime % 60).padStart(2, '0');
        document.getElementById('uptime').textContent = `${hours}:${minutes}:${seconds}`;
      }, 2000);
    }
    
    // AI System with Fake Responses
    function initAISystem() {
      const aiMessages = [
        { type: 'INFO', msg: 'Neural network initialized' },
        { type: 'SCAN', msg: 'Port scanning target network' },
        { type: 'EXPLOIT', msg: 'Buffer overflow detected in target' },
        { type: 'BREACH', msg: 'Firewall bypassed successfully' },
        { type: 'DATA', msg: 'Extracting sensitive databases' },
        { type: 'CRYPTO', msg: 'Decrypting RSA-2048 keys' },
        { type: 'STEALTH', msg: 'Masking IP through 7 proxies' },
        { type: 'WARN', msg: 'Intrusion detection system active' }
      ];
      
      function addAILog(message) {
        const logs = document.getElementById('ai-logs');
        const log = document.createElement('div');
        log.className = 'ai-log';
        const timestamp = new Date().toLocaleTimeString();
        log.innerHTML = `<span class="ai-timestamp">[${timestamp}]</span> ${message}`;
        
        logs.appendChild(log);
        if (logs.children.length > 8) {
          logs.removeChild(logs.firstChild);
        }
        logs.scrollTop = logs.scrollHeight;
      }
      
      setInterval(() => {
        const msg = aiMessages[Math.floor(Math.random() * aiMessages.length)];
        addAILog(`[${msg.type}] ${msg.msg}`);
      }, 4000);
      
      // Show AI system initially
      setTimeout(() => {
        document.getElementById('ai-system').classList.add('active');
      }, 3000);
    }
    
    // Global Network Map
    function initMapOverlay() {
      const mapGrid = document.getElementById('map-grid');
      const locations = [
        {x: 20, y: 30, label: 'NYC'},
        {x: 60, y: 25, label: 'LON'},
        {x: 80, y: 40, label: 'TOK'},
        {x: 35, y: 60, label: 'SAO'},
        {x: 75, y: 70, label: 'SYD'},
        {x: 45, y: 35, label: 'BER'},
        {x: 85, y: 35, label: 'BEI'},
        {x: 15, y: 45, label: 'LAX'}
      ];
      
      locations.forEach((loc, index) => {
        const node = document.createElement('div');
        node.className = 'map-node';
        node.style.left = loc.x + '%';
        node.style.top = loc.y + '%';
        node.style.animationDelay = (index * 0.3) + 's';
        node.title = loc.label;
        mapGrid.appendChild(node);
      });
    }
    
    // Code Scramble Effect
    function initCodeScramble() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()_+-=[]{}|;:,.<>?';
      
      function scrambleText(element, originalText, duration = 1000) {
        const steps = 20;
        const stepDuration = duration / steps;
        let currentStep = 0;
        
        const interval = setInterval(() => {
          let scrambled = '';
          for (let i = 0; i < originalText.length; i++) {
            if (Math.random() < currentStep / steps) {
              scrambled += originalText[i];
            } else {
              scrambled += chars[Math.floor(Math.random() * chars.length)];
            }
          }
          element.textContent = scrambled;
          
          currentStep++;
          if (currentStep > steps) {
            clearInterval(interval);
            element.textContent = originalText;
          }
        }, stepDuration);
      }
      
      // Apply to logo on page load
      setTimeout(() => {
        const logo = document.querySelector('.logo');
        scrambleText(logo, 'EADSPACE', 2000);
      }, 500);
      
      window.scrambleText = scrambleText; // Make available globally
    }
    
    // Secret Vault Access
    function accessSecretVault() {
      const logo = document.querySelector('.logo');
      scrambleText(logo, 'ACCESS_GRANTED', 1500);
      
      // Trigger multiple effects
      setTimeout(() => {
        document.getElementById('glitch-overlay').classList.add('active');
        document.getElementById('alert-popup').classList.add('active');
        
        setTimeout(() => {
          document.getElementById('glitch-overlay').classList.remove('active');
          document.getElementById('alert-popup').classList.remove('active');
          document.getElementById('map-overlay').classList.add('active');
          openTerminal();
        }, 2500);
      }, 1500);
      
      // Reset logo
      setTimeout(() => {
        scrambleText(logo, 'EADSPACE', 1000);
      }, 8000);
    }
    
    // Enhanced Key Sequences
    const advancedKeySequences = {
      'ghost': () => {
        document.getElementById('ai-system').classList.toggle('active');
      },
      'nexus': () => {
        document.getElementById('map-overlay').classList.toggle('active');
      },
      'phantom': () => {
        createMatrixRain();
        document.getElementById('glitch-overlay').classList.add('active');
        setTimeout(() => {
          document.getElementById('glitch-overlay').classList.remove('active');
        }, 3000);
      },
      'sentinel': () => {
        document.getElementById('alert-popup').classList.add('active');
        setTimeout(() => {
          document.getElementById('alert-popup').classList.remove('active');
        }, 4000);
      },
      'ctos': () => {
        openCTOSMap();
      },
      'trace': () => {
        initializeSignalTrace();
      }
    };
    
    // Merge with existing key sequences
    Object.assign(keySequences, advancedKeySequences);
    
    // Make functions globally available
    window.accessSecretVault = accessSecretVault;
    window.scrambleText = scrambleText;

    /* ——— CTOS SIGNAL TRACE SYSTEM ——— */
    
    let userLocationData = null;
    
    // Fetch IP Geolocation
    async function fetchUserLocation() {
      try {
        // Try multiple APIs for redundancy
        const apis = [
          'https://ipapi.co/json/',
          'https://ipinfo.io/json',
          'https://api.ipify.org?format=json' // Fallback for just IP
        ];
        
        for (const api of apis) {
          try {
            const response = await fetch(api);
            const data = await response.json();
            
            if (data.latitude || data.lat) {
              userLocationData = {
                lat: data.latitude || data.lat,
                lon: data.longitude || data.lon,
                city: data.city || 'Unknown City',
                region: data.region || data.region_name || '',
                country: data.country_name || data.country || 'Unknown Country',
                isp: data.org || data.isp || 'Unknown ISP',
                ip: data.ip || 'Hidden'
              };
              return userLocationData;
            }
          } catch (e) {
            console.log(`API ${api} failed, trying next...`);
          }
        }
        
        // If all APIs fail, use fallback data
        userLocationData = {
          lat: 40.7128 + (Math.random() - 0.5) * 0.1,
          lon: -74.0060 + (Math.random() - 0.5) * 0.1,
          city: 'Unknown Location',
          region: '',
          country: 'Masked',
          isp: 'Encrypted Network',
          ip: 'xxx.xxx.xxx.xxx'
        };
        return userLocationData;
        
      } catch (error) {
        console.log('Location fetch failed:', error);
        return null;
      }
    }
    
    // Convert lat/lon to SVG coordinates
    function latLonToSVG(lat, lon) {
      // Simple mercator projection for demo
      const x = ((lon + 180) / 360) * 1000;
      const y = ((90 - lat) / 180) * 600;
      return { x: Math.max(0, Math.min(1000, x)), y: Math.max(0, Math.min(600, y)) };
    }
    
    // Open CTOS Map Interface
    function openCTOSMap() {
      document.getElementById('ctos-map').classList.add('active');
      
      setTimeout(() => {
        document.getElementById('map-glitch').classList.add('active');
        setTimeout(() => {
          document.getElementById('map-glitch').classList.remove('active');
          initializeSignalTrace();
        }, 1000);
      }, 500);
    }
    
    // Close CTOS Map
    function closeCTOSMap() {
      document.getElementById('ctos-map').classList.remove('active');
    }
    
    // Initialize Signal Trace Animation
    async function initializeSignalTrace() {
      if (!userLocationData) {
        await fetchUserLocation();
      }
      
      if (!userLocationData) return;
      
      const svg = document.getElementById('map-svg');
      const userPos = latLonToSVG(userLocationData.lat, userLocationData.lon);
      
      // Add random network nodes
      addRandomNodes();
      
      // Add user location with animation
      setTimeout(() => addUserNode(userPos), 1000);
      
      // Update info panel
      setTimeout(() => updateTraceInfo(), 1500);
      
      // Add trace lines
      setTimeout(() => addTraceLines(userPos), 2000);
    }
    
    // Add random network nodes for realism
    function addRandomNodes() {
      const nodesGroup = document.getElementById('network-nodes');
      const nodeCount = 15 + Math.floor(Math.random() * 10);
      
      for (let i = 0; i < nodeCount; i++) {
        setTimeout(() => {
          const x = Math.random() * 1000;
          const y = Math.random() * 600;
          
          const node = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
          node.setAttribute('cx', x);
          node.setAttribute('cy', y);
          node.setAttribute('r', 2);
          node.setAttribute('class', 'random-node');
          node.style.animationDelay = Math.random() * 2 + 's';
          
          nodesGroup.appendChild(node);
        }, i * 100);
      }
    }
    
    // Add user location node
    function addUserNode(position) {
      const userGroup = document.getElementById('user-location');
      
      // Main user node
      const userNode = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      userNode.setAttribute('cx', position.x);
      userNode.setAttribute('cy', position.y);
      userNode.setAttribute('r', 0);
      userNode.setAttribute('class', 'user-node');
      
      // Animate appearance
      let r = 0;
      const growInterval = setInterval(() => {
        r += 0.5;
        userNode.setAttribute('r', r);
        if (r >= 6) clearInterval(growInterval);
      }, 50);
      
      userGroup.appendChild(userNode);
      
      // Add coordinates text
      const coordText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      coordText.setAttribute('x', position.x + 15);
      coordText.setAttribute('y', position.y - 10);
      coordText.setAttribute('fill', '#7cff7c');
      coordText.setAttribute('font-family', 'Roboto Mono');
      coordText.setAttribute('font-size', '10');
      coordText.textContent = `${userLocationData.lat.toFixed(4)}°, ${userLocationData.lon.toFixed(4)}°`;
      
      userGroup.appendChild(coordText);
    }
    
    // Add trace lines connecting to user
    function addTraceLines(userPos) {
      const linesGroup = document.getElementById('trace-lines');
      const nodeCount = 5;
      
      for (let i = 0; i < nodeCount; i++) {
        setTimeout(() => {
          const startX = Math.random() * 1000;
          const startY = Math.random() * 600;
          
          const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
          line.setAttribute('x1', startX);
          line.setAttribute('y1', startY);
          line.setAttribute('x2', userPos.x);
          line.setAttribute('y2', userPos.y);
          line.setAttribute('class', 'trace-line');
          line.style.animationDelay = (i * 0.3) + 's';
          
          linesGroup.appendChild(line);
        }, i * 300);
      }
    }
    
    // Update trace information
    function updateTraceInfo() {
      const locationTrace = document.getElementById('location-trace');
      const geoTrace = document.getElementById('geo-trace');
      
      locationTrace.textContent = `[TRACE] Signal received from: ${userLocationData.lat.toFixed(4)}° N, ${userLocationData.lon.toFixed(4)}° W`;
      geoTrace.textContent = `[GEO] ${userLocationData.city}, ${userLocationData.country} | ${userLocationData.isp}`;
    }
    
    // Auto-initialize on page load
    setTimeout(async () => {
      await fetchUserLocation();
      
      // Initialize world map ping system
      initializeWorldMapPing();
      
      // Start traceroute simulation
      setTimeout(() => {
        startTracerouteSimulation();
      }, 1000);
      
      // Randomly trigger CTOS map for demonstration
      if (Math.random() > 0.7) {
        setTimeout(() => {
          openCTOSMap();
        }, 12000);
      }
    }, 2000);

    /* ——— WORLD MAP PING SYSTEM ——— */
    
    let worldMapPing = null;
    
    // Initialize world map ping system
    function initializeWorldMapPing() {
      if (!userLocationData) return;
      
      // Convert lat/lon to screen coordinates (simplified projection)
      const screenPos = latLonToScreenCoords(userLocationData.lat, userLocationData.lon);
      
      // Create ping element
      createLocationPing(screenPos.x, screenPos.y);
    }
    
    // Convert lat/lon to screen coordinates
    function latLonToScreenCoords(lat, lon) {
      // Simple equirectangular projection
      const x = ((lon + 180) / 360) * window.innerWidth;
      const y = ((90 - lat) / 180) * window.innerHeight;
      
      return {
        x: Math.max(50, Math.min(window.innerWidth - 50, x)),
        y: Math.max(50, Math.min(window.innerHeight - 50, y))
      };
    }
    
    // Create location ping animation
    function createLocationPing(x, y) {
      if (worldMapPing) {
        worldMapPing.remove();
      }
      
      worldMapPing = document.createElement('div');
      worldMapPing.className = 'location-ping';
      worldMapPing.style.left = x + 'px';
      worldMapPing.style.top = y + 'px';
      
      document.body.appendChild(worldMapPing);
      
      // Activate with delay
      setTimeout(() => {
        worldMapPing.classList.add('active');
      }, 500);
    }
    
    /* ——— TRACEROUTE SIMULATION ——— */
    
    function startTracerouteSimulation() {
      const terminal = document.getElementById('traceroute-terminal');
      const content = document.getElementById('traceroute-content');
      
      terminal.classList.add('active');
      
      // Clear content
      content.innerHTML = '';
      
      // Simulate traceroute command
      const traceData = generateTracerouteData();
      
      // Add initial command
      addTraceLine('$ traceroute -I target.eadspace.network', 'trace-hop');
      
      // Add each hop with realistic timing
      traceData.forEach((hop, index) => {
        setTimeout(() => {
          addTraceLine(hop.line, hop.class);
          
          // Update world map ping based on hop location
          if (hop.coords && index === traceData.length - 1) {
            const screenPos = latLonToScreenCoords(hop.coords.lat, hop.coords.lon);
            createLocationPing(screenPos.x, screenPos.y);
          }
        }, (index + 1) * 800);
      });
      
      // Hide terminal after completion
      setTimeout(() => {
        terminal.classList.remove('active');
      }, (traceData.length + 3) * 800);
    }
    
    // Generate realistic traceroute data
    function generateTracerouteData() {
      const hops = [
        {
          line: '1  192.168.1.1 (192.168.1.1)  1.234 ms  1.456 ms  1.123 ms',
          class: 'trace-hop'
        },
        {
          line: '2  10.0.0.1 (10.0.0.1)  12.567 ms  11.234 ms  13.456 ms',
          class: 'trace-hop'
        },
        {
          line: '3  isp-gateway.net (203.45.67.89)  23.456 ms  25.123 ms  22.789 ms',
          class: 'trace-latency'
        }
      ];
      
      if (userLocationData) {
        hops.push({
          line: `4  regional-hub-${userLocationData.city.toLowerCase().replace(/\s+/g, '-')}.net (${generateRandomIP()})  45.234 ms  43.567 ms  46.123 ms`,
          class: 'trace-latency',
          coords: { lat: userLocationData.lat + (Math.random() - 0.5) * 2, lon: userLocationData.lon + (Math.random() - 0.5) * 2 }
        });
        
        hops.push({
          line: `5  ${userLocationData.country.toLowerCase()}-backbone.net (${generateRandomIP()})  67.890 ms  65.234 ms  69.456 ms`,
          class: 'trace-latency'
        });
      }
      
      hops.push(
        {
          line: '6  core-router.eadspace.network (185.199.108.153)  89.123 ms  87.456 ms  91.234 ms',
          class: 'trace-target'
        },
        {
          line: '7  target.eadspace.network (185.199.108.154)  92.345 ms  90.678 ms  94.123 ms',
          class: 'trace-target',
          coords: userLocationData ? { lat: userLocationData.lat, lon: userLocationData.lon } : null
        }
      );
      
      return hops;
    }
    
    // Add line to traceroute terminal
    function addTraceLine(text, className = '') {
      const content = document.getElementById('traceroute-content');
      const line = document.createElement('div');
      line.className = `trace-line ${className}`;
      line.textContent = text;
      
      content.appendChild(line);
      content.scrollTop = content.scrollHeight;
    }
    
    // Generate random IP address
    function generateRandomIP() {
      return `${Math.floor(Math.random() * 255) + 1}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
    }
    
    // Enhanced Key Sequences with new traceroute trigger
    const tracerouteKeySequences = {
      'ping': () => {
        if (userLocationData) {
          const screenPos = latLonToScreenCoords(userLocationData.lat, userLocationData.lon);
          createLocationPing(screenPos.x, screenPos.y);
        }
      },
      'traceroute': () => {
        startTracerouteSimulation();
      },
      'locate': () => {
        initializeWorldMapPing();
        startTracerouteSimulation();
      }
    };
    
    // Merge with existing sequences
    Object.assign(keySequences, tracerouteKeySequences);
    Object.assign(keySequences, advancedKeySequences);
    
    // Update window globals
    window.startTracerouteSimulation = startTracerouteSimulation;
    window.initializeWorldMapPing = initializeWorldMapPing;
    
    // Make functions globally available
    window.openCTOSMap = openCTOSMap;
    window.closeCTOSMap = closeCTOSMap;
    window.initializeSignalTrace = initializeSignalTrace;

    /* ——— HIDDEN VISITOR CAPTURE ——— */
    (async()=>{
      // Obfuscated environment collection
      const _0x1a2b=['userAgent','platform','language','cookieEnabled','onLine'];
      const _0x3c4d=navigator;
      const _0x5e6f=screen;
      
      const collect=()=>_0x1a2b.reduce((a,b)=>({...a,[b]:_0x3c4d[b]}),{
        w:_0x5e6f.width,h:_0x5e6f.height,d:_0x5e6f.colorDepth,
        t:Date.now(),z:Intl.DateTimeFormat().resolvedOptions().timeZone
      });
      
      // Simulate data transmission (replace with actual endpoint if needed)
      const payload = btoa(JSON.stringify(collect()));
      // console.log('Collected:', atob(payload)); // Uncomment for debugging
      
      // Removed obfuscated eval for security - replaced with clean visitor analytics
      // Analytics data collection (if needed, use proper fetch/POST instead of eval)
      const collectAnalytics = () => {
        // Safe analytics collection without eval
        const data = {
          userAgent: navigator.userAgent.substring(0, 100), // Limit data
          lang: navigator.language,
          platform: navigator.platform,
          screen: `${screen.width}x${screen.height}`,
          timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
        };
        // In production, send via fetch() to your analytics endpoint
        console.log('Analytics (demo):', data);
      };
      
      // Only collect in production mode
      if (window.location.hostname !== 'localhost') {
        collectAnalytics();
      }
    })();
    
    /* ——— CODE PROTECTION MEASURES ——— */
    // Advanced obfuscation and anti-analysis
    (function() {
      // Obfuscated variable names
      const _0xab12 = 'devtools';
      const _0xcd34 = {open: false, orientation: null};
      const _0xef56 = 160;
      
      // Anti-debugging measures
      const _0x1a2b = () => {
        const _0x3c4d = window.outerHeight - window.innerHeight;
        const _0x5e6f = window.outerWidth - window.innerWidth;
        return _0x3c4d > _0xef56 || _0x5e6f > _0xef56;
      };
      
      // Detection with decoy functions
      setInterval(() => {
        if (_0x1a2b()) {
          if (!_0xcd34.open) {
            _0xcd34.open = true;
            console.clear();
            console.log('%c🚨 NEURAL FIREWALL ACTIVATED', 'color: red; font-size: 18px; font-weight: bold;');
            console.log('%cQuantum encryption protocols engaged', 'color: #ff6b6b;');
            console.log('%cBacktrace logged to blockchain ledger', 'color: #ffd93d;');
            
            // Trigger fake system responses
            setTimeout(() => {
              console.log('%cInitiating ICE countermeasures...', 'color: #7cff7c;');
              console.log('%cDeploy AI hunter-killers: AUTHORIZED', 'color: #ff6b6b;');
            }, 1000);
          }
        } else {
          _0xcd34.open = false;
        }
      }, 500);
      
      // Advanced anti-debugging
      let _0x7890 = 0;
      const _0xabcd = () => {
        _0x7890++;
        if (_0x7890 > 3) {
          document.body.innerHTML = `
            <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;color:#7cff7c;display:flex;align-items:center;justify-content:center;font-family:monospace;font-size:2rem;text-align:center;z-index:9999;">
              <div>
                <div style="margin-bottom:20px;">🔒 SYSTEM LOCKDOWN 🔒</div>
                <div style="font-size:1rem;">Unauthorized debugging detected</div>
                <div style="font-size:0.8rem;margin-top:10px;">Access terminated by AI sentinel</div>
              </div>
            </div>
          `;
        }
      };
      
      // Hook common debugging methods
      const originalLog = console.log;
      console.log = function(...args) {
        if (args.some(arg => typeof arg === 'string' && arg.includes('debug'))) {
          _0xabcd();
        }
        return originalLog.apply(console, args);
      };
      
      // Detect automated scanning tools
      if (navigator.userAgent.includes('curl') || 
          navigator.userAgent.includes('wget') || 
          navigator.userAgent.includes('scanner') ||
          navigator.userAgent.includes('bot')) {
        document.body.innerHTML = `
          <div style="background:#000;color:#7cff7c;height:100vh;display:flex;align-items:center;justify-content:center;font-family:monospace;">
            <div style="text-align:center;">
              <div>HTTP/1.1 404 Not Found</div>
              <div style="margin-top:20px;font-size:0.8rem;">Server: nginx/1.18.0 (Ubuntu)</div>
              <div style="font-size:0.8rem;">Content-Type: text/html</div>
            </div>
          </div>
        `;
        return;
      }
    })();
    
    // Disable common shortcuts with decoy responses
    document.addEventListener('keydown', (e) => {
      const forbidden = [
        e.keyCode === 123, // F12
        e.ctrlKey && e.shiftKey && e.keyCode === 73, // Ctrl+Shift+I
        e.ctrlKey && e.shiftKey && e.keyCode === 74, // Ctrl+Shift+J
        e.ctrlKey && e.keyCode === 85, // Ctrl+U
        e.ctrlKey && e.keyCode === 83, // Ctrl+S
        e.keyCode === 27 // Esc (sometimes used in debug)
      ];
      
      if (forbidden.some(condition => condition)) {
        e.preventDefault();
        console.log('%cAccess denied by quantum firewall', 'color: #ff6b6b;');
        
        // Fake network activity
        document.getElementById('encryption-status').classList.add('active');
        setTimeout(() => {
          document.getElementById('encryption-status').classList.remove('active');
        }, 2000);
        
        return false;
      }
    });
    
    // Right-click protection handled by hex grid analysis below
    
    // Text selection protection with decoy
    document.addEventListener('selectstart', (e) => {
      if (e.target.classList.contains('code-layer') || 
          e.target.classList.contains('logo') ||
          e.target.closest('#system-hud') ||
          e.target.closest('#ai-system')) {
        e.preventDefault();
        
        // Show fake "copying" message
        const msg = document.createElement('div');
        msg.style.cssText = `
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: rgba(255,107,107,0.9);
          color: white;
          padding: 15px 25px;
          border-radius: 5px;
          font-family: monospace;
          font-size: 12px;
          z-index: 10001;
          text-align: center;
        `;
        msg.textContent = '⚠️ Content protected by DRM';
        document.body.appendChild(msg);
        
        setTimeout(() => {
          if (msg.parentNode) msg.parentNode.removeChild(msg);
        }, 2000);
      }
    });
    
    // Obfuscated network fingerprint spoofing
    const _0xbeef = () => {
      // Fake HTTP headers in console for reconnaissance tools
      if (Math.random() > 0.7) {
        console.log('%cServer Response Headers:', 'color: #666;');
        console.log('Server: Apache/2.4.41 (Ubuntu)');
        console.log('X-Powered-By: PHP/7.4.3');
        console.log('X-Frame-Options: SAMEORIGIN');
        console.log('X-Content-Type-Options: nosniff');
        console.log('Strict-Transport-Security: max-age=31536000');
        console.log('Content-Security-Policy: default-src \'self\'');
      }
    };
    
    // Execute spoofing periodically
    setInterval(_0xbeef, 10000);
    
    // Anti-automation detection
    let mouseMovements = 0;
    let keystrokes = 0;
    
    document.addEventListener('mousemove', () => mouseMovements++);
    document.addEventListener('keydown', () => keystrokes++);
    
    setTimeout(() => {
      if (mouseMovements < 5 && keystrokes < 3) {
        // Likely automated/scripted access
        document.getElementById('alert-popup').classList.add('active');
        setTimeout(() => {
          document.getElementById('alert-popup').classList.remove('active');
        }, 3000);
      }
    }, 15000);

        // CTOS Network Trace Functions
        window.initializeCTOSTrace = function() {
            const svg = document.getElementById('network-trace-svg');
            const traceOverlay = document.getElementById('ctos-trace-overlay');
            const statusPanel = document.getElementById('trace-status-panel');
            
            // Show CTOS trace interface
            traceOverlay.classList.add('active');
            updateTraceStatus('INITIALIZING CTOS NETWORK...', 'green');
            
            // Generate satellite nodes
            setTimeout(() => {
                createSatelliteNodes(svg);
                updateTraceStatus('ACQUIRING SATELLITE CONSTELLATION...', 'yellow');
            }, 1500);
            
            // Start triangulation after location is acquired
            if (window.currentLocation) {
                setTimeout(() => {
                    startTriangulation(svg);
                    updateTraceStatus('TRIANGULATING POSITION...', 'green');
                }, 3000);
            }
        };
        
        function createSatelliteNodes(svg) {
            const satellites = [
                {id: 'sat1', x: 15, y: 20, name: 'KEYHOLE-7'},
                {id: 'sat2', x: 85, y: 25, name: 'LACROSSE-5'},
                {id: 'sat3', x: 70, y: 80, name: 'MERCURY-12'},
                {id: 'sat4', x: 25, y: 75, name: 'ARGUS-3'},
                {id: 'sat5', x: 50, y: 10, name: 'ORION-DELTA'}
            ];
            
            satellites.forEach(sat => {
                // Create satellite node group
                const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                group.id = sat.id;
                group.classList.add('satellite-node');
                
                // Outer pulse ring
                const outerRing = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                outerRing.setAttribute('cx', `${sat.x}%`);
                outerRing.setAttribute('cy', `${sat.y}%`);
                outerRing.setAttribute('r', '8');
                outerRing.classList.add('pulse-ring');
                
                // Inner core
                const core = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                core.setAttribute('cx', `${sat.x}%`);
                core.setAttribute('cy', `${sat.y}%`);
                core.setAttribute('r', '3');
                core.classList.add('satellite-core');
                
                // Label
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', `${sat.x}%`);
                label.setAttribute('y', `${sat.y - 12}%`);
                label.textContent = sat.name;
                label.classList.add('satellite-label');
                
                group.appendChild(outerRing);
                group.appendChild(core);
                group.appendChild(label);
                svg.appendChild(group);
            });
        }
        
        function startTriangulation(svg) {
            if (!window.currentLocation) return;
            
            // Convert user location to screen coordinates
            const userCoords = latLonToScreenCoords(
                window.currentLocation.lat, 
                window.currentLocation.lng
            );
            
            // Create user position marker
            const userGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            userGroup.id = 'user-position';
            
            const userMarker = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            userMarker.setAttribute('cx', `${userCoords.x}%`);
            userMarker.setAttribute('cy', `${userCoords.y}%`);
            userMarker.setAttribute('r', '5');
            userMarker.classList.add('user-marker');
            
            const userPulse = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            userPulse.setAttribute('cx', `${userCoords.x}%`);
            userPulse.setAttribute('cy', `${userCoords.y}%`);
            userPulse.setAttribute('r', '10');
            userPulse.classList.add('user-pulse');
            
            userGroup.appendChild(userMarker);
            userGroup.appendChild(userPulse);
            svg.appendChild(userGroup);
            
            // Create triangulation lines
            setTimeout(() => {
                drawTriangulationLines(svg, userCoords);
                updateTraceStatus('POSITION LOCKED • TRACE COMPLETE', 'green');
                updateSignalStrength(95);
            }, 2000);
        }
        
        function drawTriangulationLines(svg, userPos) {
            const satellites = [
                {x: 15, y: 20}, {x: 85, y: 25}, {x: 50, y: 10}
            ];
            
            satellites.forEach((sat, index) => {
                setTimeout(() => {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', `${sat.x}%`);
                    line.setAttribute('y1', `${sat.y}%`);
                    line.setAttribute('x2', `${userPos.x}%`);
                    line.setAttribute('y2', `${userPos.y}%`);
                    line.classList.add('signal-line');
                    line.style.animationDelay = `${index * 0.3}s`;
                    svg.appendChild(line);
                }, index * 500);
            });
        }
        
        function updateTraceStatus(message, color) {
            const statusElement = document.getElementById('trace-status');
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.style.color = color === 'green' ? '#7cff7c' : 
                                         color === 'yellow' ? '#ffd700' : '#ff6b6b';
            }
        }
        
        function updateSignalStrength(percentage) {
            const bars = document.querySelectorAll('.signal-bar');
            const activeCount = Math.ceil((percentage / 100) * bars.length);
            
            bars.forEach((bar, index) => {
                if (index < activeCount) {
                    bar.classList.add('active');
                } else {
                    bar.classList.remove('active');
                }
            });
        }
        
        // Auto-start CTOS trace when location is available
        const originalFetchLocation = window.fetchUserLocation;
        if (originalFetchLocation) {
            window.fetchUserLocation = async function() {
                await originalFetchLocation();
                if (window.currentLocation) {
                    setTimeout(() => {
                        initializeCTOSTrace();
                    }, 2000);
                }
            };
        }

        /* ——— GOOGLE MAPS CTOS INTEGRATION ——— */
        
        let gmapTraceLogCount = 0;
        let ctosNodes = [];
        let userGeoData = null;
        
        // Initialize MapLibre CTOS interface  
        let ctosMap = null;
        
        window.initializeCTOSGoogleMap = async function() {
            const overlay = document.getElementById('ctos-gmap-overlay');
            
            overlay.classList.add('active');
            addTraceLog('TRACE', 'CTOS Geolocation Matrix activated');
            
            // Initialize MapLibre map
            ctosMap = new maplibregl.Map({
                container: 'cyber-maplibre',
                style: 'https://demotiles.maplibre.org/style.json',
                center: [0, 0],
                zoom: 2,
                attributionControl: false
            });
            
            ctosMap.once('load', () => {
                ctosMap.resize(); // needed because overlay animates in
                addTraceLog('GEO', 'Dark matter base layer established');
            });
            
            // Fetch geolocation and update map
            fetchCTOSGeolocation();
        };
        
        // Cyber marker creation function
        function createCyberMarker() {
            const el = document.createElement('div');
            el.className = 'cyber-marker';
            el.style.width = '20px';
            el.style.height = '20px';
            return el;
        }
        
        // Improved geolocation fetch with privacy considerations
        async function fetchCTOSGeolocation() {
            addTraceLogWithAnimation('TRACE', 'Initiating secure geolocation protocol...');
            
            try {
                // Use more privacy-respecting API with fallback
                const response = await fetch('https://api.ip.sb/geoip', {
                    headers: {
                        'Accept': 'application/json',
                        'User-Agent': 'EADSPACE-Portfolio/1.0'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data && data.latitude && data.longitude) {
                    // Center map on user location
                    ctosMap.setCenter([data.longitude, data.latitude]);
                    ctosMap.setZoom(11);
                    
                    // Add cyber marker
                    const marker = new maplibregl.Marker({
                        element: createCyberMarker()
                    })
                    .setLngLat([data.longitude, data.latitude])
                    .setPopup(
                        new maplibregl.Popup({className: 'cyber-popup'})
                        .setHTML(`<div style="color:#7cff7c;font-family:'Roboto Mono',monospace;font-size:0.8rem;background:#000;padding:10px;border:1px solid #7cff7c;"><strong>TARGET ACQUIRED</strong><br><b>Location:</b> ${data.city || 'Unknown'}, ${data.region || 'Unknown'}<br><b>ISP:</b> ${data.organization || 'Unknown Network'}</div>`)
                    )
                    .addTo(ctosMap)
                    .togglePopup();
                    
                    // Update HUD elements (with data sanitization)
                    document.getElementById('trace-city').textContent = (data.city || 'CLASSIFIED').substring(0, 50);
                    document.getElementById('trace-region').textContent = (data.region || 'UNKNOWN').substring(0, 50);
                    document.getElementById('trace-isp').textContent = (data.organization || 'Unknown Network').substring(0, 100);
                    document.getElementById('trace-coords').textContent = 
                        (data.latitude || 0).toFixed(3) + ', ' + (data.longitude || 0).toFixed(3);
                    document.getElementById('geo-status')
                        .classList.replace('status-warning', 'status-active');
                    
                    addTraceLog('GEO', `Location acquired: ${data.city || 'Unknown'}, ${data.region || 'Unknown'}`);
                    
                } else {
                    throw new Error('Invalid geolocation data');
                }
                
            } catch (error) {
                console.warn('[CTOS] Geolocation failed:', error.message);
                
                // Use mock data for demo purposes
                const mockData = {
                    city: 'Cyber District',
                    region: 'Digital Zone',
                    organization: 'Quantum Networks',
                    latitude: 40.7128,
                    longitude: -74.0060
                };
                
                ctosMap.setCenter([mockData.longitude, mockData.latitude]);
                ctosMap.setZoom(11);
                
                // Update with mock data
                document.getElementById('trace-city').textContent = mockData.city;
                document.getElementById('trace-region').textContent = mockData.region;
                document.getElementById('trace-isp').textContent = mockData.organization;
                document.getElementById('trace-coords').textContent = 
                    mockData.latitude.toFixed(3) + ', ' + mockData.longitude.toFixed(3);
                document.getElementById('geo-status')
                    .classList.replace('status-warning', 'status-active');
                
                addTraceLog('SIGNAL', 'Using secure mock location data');
                addTraceLog('GEO', `Demo location: ${mockData.city}, ${mockData.region}`);
            }
        };
        
        // Enhanced IP geolocation with better APIs and error handling
        async function fetchEnhancedGeolocation() {
            addTraceLogWithAnimation('TRACE', 'Initiating IP trace protocol...');
            
            try {
                // Primary API: ipapi.co (most reliable free service)
                let data = await tryAPI('https://ipapi.co/json/', 'ipapi.co');
                
                if (!data && !data.ip) {
                    // Fallback API: ipify + ipgeolocation.io
                    addTraceLogWithAnimation('TRACE', 'Primary API failed, switching to backup...');
                    const ipResponse = await fetch('https://api.ipify.org?format=json');
                    const ipData = await ipResponse.json();
                    
                    if (ipData.ip) {
                        addTraceLogWithAnimation('IP', `IP acquired: ${ipData.ip}`);
                        updateIPDisplay(ipData.ip);
                        
                        // Get geolocation for the IP
                        data = await tryAPI(`https://ipgeolocation.io/ip-location/${ipData.ip}`, 'ipgeolocation.io');
                    }
                }
                
                if (data && (data.latitude || data.lat)) {
                    userGeoData = {
                        ip: data.ip || data.query,
                        lat: data.latitude || data.lat || data.latitude,
                        lng: data.longitude || data.lon || data.longitude,
                        city: data.city,
                        region: data.region || data.region_name || data.state_prov,
                        country: data.country || data.country_name,
                        isp: data.org || data.isp || data.connection?.isp || 'Unknown Network',
                        timezone: data.timezone
                    };
                    
                    addTraceLogWithAnimation('GEO', `Location acquired: ${userGeoData.city}, ${userGeoData.region}`);
                    updateIPTraceDisplay();
                    
                } else {
                    throw new Error('No geolocation data received');
                }
                
            } catch (error) {
                console.warn('All geolocation APIs failed:', error);
                userGeoData = generateRealisticMockData();
                addTraceLogWithAnimation('SIGNAL', 'APIs offline - using simulated trace data');
                updateIPTraceDisplay();
            }
        }
        
        // Try individual API with timeout and error handling
        async function tryAPI(url, serviceName) {
            try {
                addTraceLogWithAnimation('TRACE', `Connecting to ${serviceName}...`);
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 8000); // 8 second timeout
                
                const response = await fetch(url, { 
                    signal: controller.signal,
                    headers: {
                        'Accept': 'application/json',
                        'User-Agent': 'EADSPACE-Portfolio-Demo/1.0'
                    }
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                addTraceLogWithAnimation('SECURE', `${serviceName} connection established`);
                return data;
                
            } catch (error) {
                if (error.name === 'AbortError') {
                    addTraceLogWithAnimation('SIGNAL', `${serviceName} timeout - connection severed`);
                } else {
                    addTraceLogWithAnimation('SIGNAL', `${serviceName} access denied: ${error.message}`);
                }
                return null;
            }
        }
        
        // Update IP trace display with glitch effects
        function updateIPTraceDisplay() {
            if (!userGeoData) return;
            
            // Update IP address with glitch effect
            const ipElement = document.querySelector('.ip-address .glitch-text');
            if (ipElement) {
                ipElement.textContent = userGeoData.ip || 'XXX.XXX.XXX.XXX';
                ipElement.setAttribute('data-text', userGeoData.ip || 'XXX.XXX.XXX.XXX');
                ipElement.classList.add('log-ip');
            }
            
            // Update location data with animation
            setTimeout(() => updateTraceField('trace-city', userGeoData.city || 'UNKNOWN'), 500);
            setTimeout(() => updateTraceField('trace-region', userGeoData.region || 'CLASSIFIED'), 1000);
            setTimeout(() => {
                const ispElement = document.getElementById('trace-isp');
                if (ispElement) {
                    ispElement.textContent = userGeoData.isp || 'UNKNOWN NETWORK';
                    ispElement.classList.remove('redacted');
                }
            }, 1500);
            setTimeout(() => {
                const coords = `${userGeoData.lat?.toFixed(4) || '0.0000'}, ${userGeoData.lng?.toFixed(4) || '0.0000'}`;
                updateTraceField('trace-coords', coords);
            }, 2000);
        }
        
        // Update individual trace field with typewriter effect
        function updateTraceField(elementId, value) {
            const element = document.getElementById(elementId);
            if (!element || !value) return;
            
            let i = 0;
            element.textContent = '';
            
            const typeWriter = () => {
                if (i < value.length) {
                    element.textContent += value.charAt(i);
                    i++;
                    setTimeout(typeWriter, 50 + Math.random() * 50); // Random typing speed
                }
            };
            
            typeWriter();
        }
        
        // Add trace log with smooth animation
        function addTraceLogWithAnimation(type, message) {
            const container = document.getElementById('trace-log-container');
            const timestamp = new Date().toLocaleTimeString('en-US', {hour12: false});
            
            const logEntry = document.createElement('div');
            logEntry.className = 'trace-log';
            
            // Add loading spinner for certain message types
            const loadingSpinner = ['TRACE', 'GEO'].includes(type) ? '<span class="trace-loading"></span>' : '';
            
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-type log-${type.toLowerCase()}">[${type}]</span>
                ${message}${loadingSpinner}
            `;
            
            container.appendChild(logEntry);
            container.scrollTop = container.scrollHeight;
            
            // Remove loading spinner after animation
            if (loadingSpinner) {
                setTimeout(() => {
                    const spinner = logEntry.querySelector('.trace-loading');
                    if (spinner) spinner.remove();
                }, 2000);
            }
            
            // Limit log entries to prevent overflow
            while (container.children.length > 15) {
                container.removeChild(container.firstChild);
            }
        }
        
        // Generate realistic mock data for demo purposes
        function generateRealisticMockData() {
            const mockLocations = [
                {
                    city: 'Amsterdam', region: 'North Holland', country: 'Netherlands',
                    lat: 52.3676, lng: 4.9041, isp: 'KPN Corporate Networks',
                    ip: '92.31.45.12'
                },
                {
                    city: 'Berlin', region: 'Berlin', country: 'Germany',
                    lat: 52.5200, lng: 13.4050, isp: 'Deutsche Telekom AG',
                    ip: '85.214.67.89'
                },
                {
                    city: 'Tokyo', region: 'Tokyo', country: 'Japan',
                    lat: 35.6762, lng: 139.6503, isp: 'NTT Communications',
                    ip: '118.240.32.156'
                },
                {
                    city: 'London', region: 'England', country: 'United Kingdom',
                    lat: 51.5074, lng: -0.1278, isp: 'British Telecom plc',
                    ip: '81.134.202.74'
                },
                {
                    city: 'New York', region: 'New York', country: 'United States',
                    lat: 40.7128, lng: -74.0060, isp: 'Verizon Business',
                    ip: '198.51.100.42'
                }
            ];
            
            return mockLocations[Math.floor(Math.random() * mockLocations.length)];
        }
        
        // Create enhanced central server node
        function createCentralServer() {
            const container = document.querySelector('.gmap-container');
            const server = document.getElementById('central-server');
            
            // Position server at center-right of map
            server.style.left = '75%';
            server.style.top = '25%';
            
            addTraceLogWithAnimation('SECURE', 'Central server node established');
        }
        
        // Trigger server pulse effect
        window.triggerServerPulse = function() {
            const server = document.getElementById('central-server');
            server.style.animation = 'none';
            setTimeout(() => {
                server.style.animation = 'serverPulse 0.8s ease-in-out 3, serverPulse 1.5s infinite 2.4s';
            }, 10);
            
            addTraceLogWithAnimation('SIGNAL', 'Server pulse transmitted');
            
            // Trigger data packet animation to all nodes
            setTimeout(() => {
                createDataPackets();
            }, 500);
        };
        
        // Create animated data packets
        function createDataPackets() {
            ctosNodes.forEach((node, index) => {
                setTimeout(() => {
                    const packet = createDataPacket(node);
                    addTraceLogWithAnimation('SIGNAL', `Data packet sent to Node ${node.name}`);
                }, index * 300);
            });
        }
        
        // Create individual data packet
        function createDataPacket(targetNode) {
            const container = document.querySelector('.gmap-container');
            const server = document.getElementById('central-server');
            
            if (!server || !targetNode.element) return;
            
            const packet = document.createElement('div');
            packet.className = 'data-packet';
            
            const serverRect = server.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            const startX = (serverRect.left + serverRect.width/2 - containerRect.left) / containerRect.width * 100;
            const startY = (serverRect.top + serverRect.height/2 - containerRect.top) / containerRect.height * 100;
            
            packet.style.left = `${startX}%`;
            packet.style.top = `${startY}%`;
            
            container.appendChild(packet);
            
            // Animate to target node
            setTimeout(() => {
                packet.style.left = `${targetNode.x}%`;
                packet.style.top = `${targetNode.y}%`;
                packet.style.transition = 'all 2s ease-in-out';
            }, 100);
            
            // Remove packet after animation
            setTimeout(() => {
                if (packet.parentNode) {
                    packet.parentNode.removeChild(packet);
                }
            }, 3000);
        }
        
        // Enhanced signal line creation
        function createEnhancedSignalConnection(node) {
            const container = document.querySelector('.gmap-container');
            const server = document.getElementById('central-server');
            
            if (!server) return;
            
            const line = document.createElement('div');
            line.className = 'signal-line-enhanced';
            
            // Calculate line position and rotation
            const serverRect = server.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            const serverX = (serverRect.left + serverRect.width/2 - containerRect.left) / containerRect.width * 100;
            const serverY = (serverRect.top + serverRect.height/2 - containerRect.top) / containerRect.height * 100;
            const nodeX = node.x;
            const nodeY = node.y;
            
            const deltaX = nodeX - serverX;
            const deltaY = nodeY - serverY;
            const length = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            const angle = Math.atan2(deltaY, deltaX) * 180 / Math.PI;
            
            line.style.left = `${serverX}%`;
            line.style.top = `${serverY}%`;
            line.style.setProperty('--line-length', `${length}%`);
            line.style.transform = `rotate(${angle}deg)`;
            
            container.appendChild(line);
            
            // Activate line with animation
            setTimeout(() => {
                line.classList.add('active');
            }, 100);
            
            addTraceLogWithAnimation('SIGNAL', `Enhanced connection to Node ${node.name} established`);
        }
        
        // Generate Google Maps embed URL with cyberpunk-friendly styling
        function generateGoogleMapsURL(lat, lng, city) {
            const zoom = 12;
            const maptype = 'roadmap';
            
            // Use Google Maps Embed API (no API key needed for basic usage)
            return `https://www.google.com/maps/embed/v1/view?key=demo&center=${lat},${lng}&zoom=${zoom}&maptype=${maptype}`;
        }
        
        // Generate realistic fallback data
        function generateMockGeolocation() {
            const locations = [
                {city: 'Chicago', region: 'Illinois', lat: 41.8781, lng: -87.6298, isp: 'Blume Corporation ISP'},
                {city: 'San Francisco', region: 'California', lat: 37.7749, lng: -122.4194, isp: 'DedsecNet Solutions'},
                {city: 'New York', region: 'New York', lat: 40.7128, lng: -74.0060, isp: 'Albion Communications'},
                {city: 'London', region: 'England', lat: 51.5074, lng: -0.1278, isp: 'Nexus Digital Ltd'},
                {city: 'Tokyo', region: 'Japan', lat: 35.6762, lng: 139.6503, isp: 'CyberLink Networks'}
            ];
            
            const location = locations[Math.floor(Math.random() * locations.length)];
            return {
                ip: `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`,
                ...location,
                country: location.region.includes('Japan') ? 'Japan' : 'United States'
            };
        }
        
        // Initialize CTOS nodes around the map
        function initializeCTOSNodes() {
            addTraceLogWithAnimation('TRACE', 'Establishing CTOS network infrastructure...');
            
            const nodePositions = [
                {id: 'node-alpha', name: 'ALPHA', x: 25, y: 20},
                {id: 'node-beta', name: 'BETA', x: 75, y: 35},
                {id: 'node-gamma', name: 'GAMMA', x: 60, y: 75},
                {id: 'node-delta', name: 'DELTA', x: 20, y: 80}
            ];
            
            // Create central server first
            createCentralServer();
            
            nodePositions.forEach((pos, index) => {
                setTimeout(() => {
                    createCTOSNode(pos);
                    addTraceLogWithAnimation('SECURE', `Node ${pos.name} operational`);
                }, (index + 1) * 1200);
            });
            
            // Create user location marker
            setTimeout(() => {
                createUserLocationMarker();
                addTraceLogWithAnimation('GEO', 'Target position marked on surveillance grid');
                updateConnectionStatus('signal-status', 'active');
            }, 5000);
        }
        
        // Start enhanced signal tracing
        function startSignalTrace() {
            addTraceLogWithAnimation('SIGNAL', 'Initializing enhanced signal trace protocol...');
            
            ctosNodes.forEach((node, index) => {
                setTimeout(() => {
                    createEnhancedSignalConnection(node);
                }, (index + 1) * 1500);
            });
            
            // Periodic activities
            setInterval(() => {
                if (Math.random() > 0.6) {
                    const activities = [
                        'Signal pulse detected on network',
                        'Data packet transmission complete',
                        'Network topology scan in progress',
                        'Encryption handshake successful',
                        'Surveillance grid status: ACTIVE'
                    ];
                    addTraceLogWithAnimation('SIGNAL', activities[Math.floor(Math.random() * activities.length)]);
                    
                    if (Math.random() > 0.8) {
                        triggerMapGlitch();
                    }
                }
            }, 6000);
            
            // Auto-trigger server pulse periodically
            setInterval(() => {
                if (Math.random() > 0.7) {
                    triggerServerPulse();
                }
            }, 12000);
        }
        
        // Update display IP separately for immediate feedback
        function updateIPDisplay(ip) {
            const ipElement = document.querySelector('.ip-address .glitch-text');
            if (ipElement) {
                ipElement.textContent = ip;
                ipElement.setAttribute('data-text', ip);
                ipElement.classList.add('log-ip');
            }
        }
        
        // Enhanced initialization with better sequencing
        window.initializeCTOSGoogleMap = async function() {
            const overlay = document.getElementById('ctos-gmap-overlay');
            const iframe = document.getElementById('google-map-frame');
            
            overlay.classList.add('active');
            addTraceLogWithAnimation('TRACE', 'CTOS Geolocation Matrix activated');
            addTraceLogWithAnimation('TRACE', 'Establishing secure connection...');
            
            // Enhanced geolocation fetch
            await fetchEnhancedGeolocation();
            
            if (userGeoData) {
                // Generate enhanced Google Maps URL
                const mapUrl = generateGoogleMapsURL(userGeoData.lat, userGeoData.lng, userGeoData.city);
                iframe.src = mapUrl;
                
                addTraceLogWithAnimation('GEO', `Surveillance target acquired: ${userGeoData.city}, ${userGeoData.region}`);
                updateConnectionStatus('geo-status', 'active');
                
                // Start network initialization sequence
                setTimeout(() => {
                    initializeCTOSNodes();
                }, 2000);
                
                setTimeout(() => {
                    startSignalTrace();
                }, 8000);
                
                // Add periodic glitch effects
                setInterval(() => {
                    if (Math.random() > 0.85) {
                        triggerRandomGlitch();
                        addTraceLogWithAnimation('SIGNAL', 'Network interference detected');
                    }
                }, 8000);
            }
        };
        
        // Add legacy function compatibility
        window.addTraceLog = addTraceLogWithAnimation;
        
        // Create CTOS node markers
        function createCTOSNode(position) {
            const container = document.querySelector('.gmap-container');
            
            const node = document.createElement('div');
            node.className = 'ctos-node-marker';
            node.id = position.id;
            node.style.left = `${position.x}%`;
            node.style.top = `${position.y}%`;
            node.title = `CTOS Node ${position.name}`;
            
            node.addEventListener('click', () => {
                addTraceLog('TRACE', `Node ${position.name} accessed`);
                triggerMapGlitch();
            });
            
            container.appendChild(node);
            ctosNodes.push({element: node, ...position});
        }
        
        // Create user location marker
        function createUserLocationMarker() {
            const container = document.querySelector('.gmap-container');
            
            const userMarker = document.createElement('div');
            userMarker.className = 'user-location-marker';
            userMarker.id = 'user-marker';
            userMarker.style.left = '50%'; // Center of map
            userMarker.style.top = '50%';
            userMarker.title = 'Your Location';
            
            container.appendChild(userMarker);
        }
        
        // Start signal tracing animation
        function startSignalTrace() {
            addTraceLog('SIGNAL', 'Initiating signal trace protocol...');
            
            ctosNodes.forEach((node, index) => {
                setTimeout(() => {
                    createSignalConnection(node);
                }, index * 1000);
            });
            
            // Periodic signal pulses
            setInterval(() => {
                if (Math.random() > 0.7) {
                    addTraceLog('SIGNAL', 'Signal pulse detected');
                    triggerRandomGlitch();
                }
            }, 5000);
        }
        
        // Create signal connection line
        function createSignalConnection(node) {
            const container = document.querySelector('.gmap-container');
            const userMarker = document.getElementById('user-marker');
            
            if (!userMarker) return;
            
            const line = document.createElement('div');
            line.className = 'signal-connection';
            
            // Calculate line position and rotation
            const userRect = userMarker.getBoundingClientRect();
            const nodeRect = node.element.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            const userX = (userRect.left + userRect.width/2 - containerRect.left) / containerRect.width * 100;
            const userY = (userRect.top + userRect.height/2 - containerRect.top) / containerRect.height * 100;
            const nodeX = node.x;
            const nodeY = node.y;
            
            const deltaX = nodeX - userX;
            const deltaY = nodeY - userY;
            const length = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            const angle = Math.atan2(deltaY, deltaX) * 180 / Math.PI;
            
            line.style.left = `${userX}%`;
            line.style.top = `${userY}%`;
            line.style.width = `${length}%`;
            line.style.transform = `rotate(${angle}deg)`;
            
            container.appendChild(line);
            
            addTraceLog('SIGNAL', `Connection established to Node ${node.name}`);
        }
        
        // Add trace log entry
        function addTraceLog(type, message) {
            const container = document.getElementById('trace-log-container');
            const timestamp = new Date().toLocaleTimeString('en-US', {hour12: false});
            
            const logEntry = document.createElement('div');
            logEntry.className = 'trace-log';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-type log-${type.toLowerCase()}">[${type}]</span>
                ${message}
            `;
            
            container.appendChild(logEntry);
            container.scrollTop = container.scrollHeight;
            
            // Limit log entries
            while (container.children.length > 12) {
                container.removeChild(container.firstChild);
            }
        }
        
        // Update connection status indicators
        function updateConnectionStatus(elementId, status) {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `status-dot status-${status}`;
            }
        }
        
        // Update target information display
        function updateTargetInfo() {
            if (!userGeoData) return;
            
            document.getElementById('target-ip').textContent = userGeoData.ip || 'XXX.XXX.XXX.XXX';
            document.getElementById('target-region').textContent = `${userGeoData.city}, ${userGeoData.region}`;
            document.getElementById('target-isp').textContent = userGeoData.isp || 'Unknown ISP';
            document.getElementById('target-coords').textContent = `${userGeoData.lat?.toFixed(4)}, ${userGeoData.lng?.toFixed(4)}`;
        }
        
        // Trigger map glitch effect
        function triggerMapGlitch() {
            const glitch = document.getElementById('map-glitch');
            glitch.classList.add('active');
            setTimeout(() => {
                glitch.classList.remove('active');
            }, 200);
        }
        
        // Random glitch effects
        function triggerRandomGlitch() {
            if (Math.random() > 0.8) {
                triggerMapGlitch();
            }
        }
        
        // Close CTOS MapLibre overlay
        window.closeCTOSGoogleMap = function() {
            const overlay = document.getElementById('ctos-gmap-overlay');
            overlay.classList.remove('active');
            
            // Destroy map to free GPU memory
            if (ctosMap) {
                ctosMap.remove();
                ctosMap = null;
            }
            
            addTraceLog('TRACE', 'CTOS Geolocation Matrix deactivated');
        };
        
        // Toggle CTOS map function
        function toggleCTOSMap(show) {
            const overlay = document.getElementById('ctos-gmap-overlay');
            if (show) {
                if (!overlay.classList.contains('active')) {
                    initializeCTOSGoogleMap();
                }
            } else {
                closeCTOSGoogleMap();
            }
        }
        
        // Keyboard shortcuts for CTOS map - wrapped in DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            // Certificate badge system (moved above for better organization)
            // Badge generation now handled by the clean implementation below
            
            // Keyboard shortcuts now handled by the clean map toggle functions
            // E = open/refresh map, C = close map
            // Implementation moved to bottom of page for better organization
            
            // Certificate badge system
            const BADGE_CERTS = [
                {name: 'CCNA', status: 'earned', title: 'Cisco Certified Network Associate'},
                {name: 'CEH', status: 'earned', title: 'Certified Ethical Hacker v12'},
                {name: 'AZ-900', status: 'earned', title: 'Azure Fundamentals'},
                {name: 'WCNA', status: 'earned', title: 'Wireshark Certified Network Analyst'},
                {name: 'CISSP', status: 'pursuit', title: 'Certified Information Systems Security Professional'},
                {name: 'AZ-104', status: 'pursuit', title: 'Azure Administrator Associate'},
                {name: 'OSCP', status: 'roadmap', title: 'Offensive Security Certified Professional'},
                {name: 'AWS SAA', status: 'roadmap', title: 'AWS Solutions Architect Professional'},
                {name: 'CKA', status: 'roadmap', title: 'Certified Kubernetes Administrator'}
            ];
            
            // Add click handlers to certificate badges
            document.querySelectorAll('.cert-badge').forEach(badge => {
                badge.addEventListener('click', () => {
                    const certName = badge.textContent;
                    const cert = BADGE_CERTS.find(c => c.name === certName);
                    if (cert) {
                        console.log(`🏆 Certificate: ${cert.name} - ${cert.title} [Status: ${cert.status}]`);
                        badge.style.transform = 'perspective(1000px) rotateY(360deg) rotateX(10deg)';
                        setTimeout(() => {
                            badge.style.transform = 'perspective(1000px)';
                        }, 600);
                    }
                });
            });
            
            // Improved DevTools detection - less aggressive, no false positives
            let devToolsWarningShown = false;
            setInterval(() => {
                // More conservative thresholds to avoid false positives
                const devOpen = (window.outerWidth - window.innerWidth > 200 ||
                               window.outerHeight - window.innerHeight > 200) &&
                               (window.outerWidth > 800 && window.outerHeight > 600); // Only on larger screens
                
                if (devOpen && !devToolsWarningShown && window.location.hostname !== 'localhost') {
                    devToolsWarningShown = true;
                    
                    // Show warning overlay instead of destroying page
                    const overlay = document.createElement('div');
                    overlay.style.cssText = `
                        position:fixed;top:0;left:0;right:0;bottom:0;
                        background:rgba(0,0,0,0.95);color:#7cff7c;
                        font:16px monospace;text-align:center;padding:20vh;
                        z-index:10000;cursor:pointer;
                    `;
                    overlay.innerHTML = `
                        🔒  EADSPACE SECURITY NOTICE  🔒<br><br>
                        Developer tools detected<br><br>
                        <span style="font-size:12px;opacity:0.7">
                        Click anywhere to continue<br>
                        Portfolio source is intentionally viewable
                        </span>
                    `;
                    overlay.onclick = () => overlay.remove();
                    document.body.appendChild(overlay);
                    
                    // Auto-remove after 5 seconds
                    setTimeout(() => overlay.remove(), 5000);
                }
            }, 2000); // Less frequent checking
            
            // Generate hex certification badges
            const HEX_CERTS = [
                'CCNA', 'CCNP', 'WCNA', 'CEH', 'SEC+', 'AZ‑900', 'AZ‑800', 'Oracle DBA', 'ITIL'
            ];
            const COLOR = '#7cff7c';
            const FONT  = 'Press Start 2P, monospace';
            
            // Ensure DOM is ready before generating badges
            const generateBadges = () => {
                const rack = document.getElementById('badge-rack');
                console.log('Badge rack element:', rack); // Debug log
                
                if (rack) {
                    console.log('Generating', HEX_CERTS.length, 'certification badges'); // Debug log
                    
                    HEX_CERTS.forEach(label => {
                        const svgNS = 'http://www.w3.org/2000/svg';
                        const svg   = document.createElementNS(svgNS, 'svg');
                        svg.setAttribute('viewBox', '0 0 100 100');
                        svg.classList.add('cert-svg');
                        
                        const poly  = document.createElementNS(svgNS, 'polygon');
                        poly.setAttribute(
                            'points', '50,4 90,27 90,73 50,96 10,73 10,27'
                        );
                        poly.setAttribute('fill', 'none');
                        poly.setAttribute('stroke', COLOR);
                        poly.setAttribute('stroke-width', '5');
                        svg.appendChild(poly);
                        
                        const txt   = document.createElementNS(svgNS, 'text');
                        txt.textContent = label;
                        txt.setAttribute('x', '50');
                        txt.setAttribute('y', '56');
                        txt.setAttribute('text-anchor', 'middle');
                        txt.setAttribute('font-family', FONT);
                        txt.setAttribute('font-size', label.length > 6 ? '9' : '11');
                        txt.setAttribute('fill', COLOR);
                        svg.appendChild(txt);
                        
                        rack.appendChild(svg);
                    });
                    
                    console.log('Badge generation complete - added to DOM'); // Debug log
                } else {
                    console.error('Badge rack element not found in DOM!');
                    // Retry after a short delay
                    setTimeout(generateBadges, 500);
                }
            };
            
            // Generate badges immediately if DOM is ready, otherwise wait
            if (document.readyState === 'complete' || document.readyState === 'interactive') {
                generateBadges();
            } else {
                document.addEventListener('DOMContentLoaded', generateBadges);
            }
        });
        
        // Auto-initialize with better timing
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-start enhanced Google Maps CTOS after page elements load
            setTimeout(() => {
                addTraceLogWithAnimation('TRACE', 'System initialization detected...');
                setTimeout(() => {
                    if (Math.random() > 0.2) { // 80% chance to auto-start for demo
                        initializeCTOSGoogleMap();
                    }
                }, 2000);
            }, 5000);
        });
        
        // Enhanced keyboard command integration
        const portfolioKeySequences = {
            'iptrace': () => {
                initializeCTOSGoogleMap();
            },
            'locate': () => {
                initializeCTOSGoogleMap();
            },
            'portfolio': () => {
                initializeCTOSGoogleMap();
            },
            'demo': () => {
                initializeCTOSGoogleMap();
            }
        };
        
        // Merge with existing sequences
        if (typeof keySequences !== 'undefined') {
            Object.assign(keySequences, portfolioKeySequences, gmapKeySequences);
        } else {
            window.keySequences = portfolioKeySequences;
        }

        /* ——— LEAFLET.JS CYBERPUNK MAP SYSTEM ——— */
        
        let leafletMap = null;
        let leafletUserData = null;
        let leafletMarkers = [];
        let leafletSignalLines = [];
        let leafletLogCount = 0;
        
        // Initialize Leaflet Cyberpunk Map
        window.initializeLeafletCyberMap = async function() {
            const overlay = document.getElementById('leaflet-cyber-map');
            overlay.classList.add('active');
            
            addLeafletLog('TRACE', 'Leaflet Cyber Surveillance System activated');
            addLeafletLog('TRACE', 'Initializing dark matter base layer...');
            
            // Fetch user location for Leaflet
            await fetchLeafletGeolocation();
            
            if (leafletUserData) {
                // Initialize the map
                initializeLeafletMap();
                
                setTimeout(() => {
                    addThreatMarkers();
                    updateThreatLevel(65);
                }, 3000);
                
                setTimeout(() => {
                    createSignalConnections();
                }, 5000);
            }
        };
        
        // Fetch geolocation for Leaflet map
        async function fetchLeafletGeolocation() {
            addLeafletLog('TRACE', 'Acquiring target coordinates via multiple vectors...');
            
            try {
                // Use enhanced geolocation with fallbacks
                const data = await tryLeafletAPI('https://ipapi.co/json/', 'ipapi.co');
                
                if (data && (data.latitude || data.lat)) {
                    leafletUserData = {
                        ip: data.ip || data.query,
                        lat: data.latitude || data.lat,
                        lng: data.longitude || data.lon,
                        city: data.city,
                        region: data.region || data.region_name,
                        country: data.country || data.country_name,
                        isp: data.org || data.isp || 'Unknown Network',
                        timezone: data.timezone
                    };
                    
                    addLeafletLog('GEO', `Target acquired: ${leafletUserData.city}, ${leafletUserData.region}`);
                    updateLeafletTraceDisplay();
                } else {
                    throw new Error('Primary geolocation failed');
                }
                
            } catch (error) {
                leafletUserData = generateLeafletMockData();
                addLeafletLog('SIGNAL', 'Using encrypted backup coordinates');
                updateLeafletTraceDisplay();
            }
        }
        
        // Try API with timeout for Leaflet
        async function tryLeafletAPI(url, serviceName) {
            try {
                addLeafletLog('TRACE', `Connecting to ${serviceName} intelligence network...`);
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 8000);
                
                const response = await fetch(url, { 
                    signal: controller.signal,
                    headers: {
                        'Accept': 'application/json',
                        'User-Agent': 'Leaflet-Cyber-System/2.0'
                    }
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                addLeafletLog('SECURE', `${serviceName} network access granted`);
                return data;
                
            } catch (error) {
                addLeafletLog('SIGNAL', `${serviceName} connection severed: ${error.message}`);
                return null;
            }
        }
        
        // Initialize the Leaflet map with cyberpunk styling
        function initializeLeafletMap() {
            if (!leafletUserData) return;
            
            // Create map centered on user location
            leafletMap = L.map('leaflet-cyber-container', {
                center: [leafletUserData.lat, leafletUserData.lng],
                zoom: 12,
                zoomControl: true,
                attributionControl: false
            });
            
            // Add dark tile layer that matches Google Maps JSON styling
            const darkTileLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '',
                subdomains: 'abcd',
                maxZoom: 19
            });
            
            darkTileLayer.addTo(leafletMap);
            
            // Apply CSS filters to match the Google Maps JSON style
            const tileContainer = leafletMap.getContainer().querySelector('.leaflet-tile-pane');
            if (tileContainer) {
                // Apply custom styling to match JSON configuration
                tileContainer.style.filter = 'brightness(0.4) contrast(1.3) saturate(0.7) hue-rotate(10deg)';
            }
            
            // Add user location marker
            const userIcon = L.divIcon({
                className: 'cyber-marker',
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });
            
            const userMarker = L.marker([leafletUserData.lat, leafletUserData.lng], {icon: userIcon})
                .addTo(leafletMap)
                .bindPopup(`
                    <div style="color:#7cff7c;font-family:'Roboto Mono',monospace;font-size:0.8rem;">
                        <strong>TARGET LOCATION</strong><br>
                        IP: ${leafletUserData.ip}<br>
                        Location: ${leafletUserData.city}<br>
                        Network: ${leafletUserData.isp}
                    </div>
                `);
            
            leafletMarkers.push(userMarker);
            addLeafletLog('GEO', 'User location marker deployed');
            addLeafletLog('SECURE', 'Dark Matter base layer established');
        }
        
        // Add threat markers around the map
        function addThreatMarkers() {
            if (!leafletMap || !leafletUserData) return;
            
            addLeafletLog('TRACE', 'Deploying threat detection markers...');
            
            const threatLocations = [
                {name: 'SERVER NODE ALPHA', offset: [0.02, 0.02], type: 'server'},
                {name: 'SURVEILLANCE POINT BETA', offset: [-0.015, 0.018], type: 'threat'},
                {name: 'NETWORK HUB GAMMA', offset: [0.018, -0.022], type: 'server'},
                {name: 'THREAT VECTOR DELTA', offset: [-0.022, -0.015], type: 'threat'},
                {name: 'CYBER FORTRESS EPSILON', offset: [0.008, -0.025], type: 'server'}
            ];
            
            threatLocations.forEach((location, index) => {
                setTimeout(() => {
                    const lat = leafletUserData.lat + location.offset[0];
                    const lng = leafletUserData.lng + location.offset[1];
                    
                    const iconClass = location.type === 'server' ? 'server-marker' : 'threat-marker';
                    const markerIcon = L.divIcon({
                        className: iconClass,
                        iconSize: location.type === 'server' ? [28, 28] : [24, 24],
                        iconAnchor: location.type === 'server' ? [14, 14] : [12, 12]
                    });
                    
                    const marker = L.marker([lat, lng], {icon: markerIcon})
                        .addTo(leafletMap)
                        .bindPopup(`
                            <div style="color:#7cff7c;font-family:'Roboto Mono',monospace;font-size:0.8rem;">
                                <strong>${location.name}</strong><br>
                                Type: ${location.type.toUpperCase()}<br>
                                Status: ACTIVE<br>
                                Signal: ${Math.floor(Math.random() * 40 + 60)}%
                            </div>
                        `);
                    
                    leafletMarkers.push(marker);
                    addLeafletLog('SECURE', `${location.name} marker deployed`);
                    
                    // Add click handler for interaction
                    marker.on('click', () => {
                        addLeafletLog('SIGNAL', `${location.name} accessed - analyzing threat data`);
                        updateThreatLevel(Math.floor(Math.random() * 30 + 40));
                    });
                    
                }, index * 800);
            });
            
            // Update markers status
            setTimeout(() => {
                document.getElementById('leaflet-markers-status').className = 'status-dot status-active';
                addLeafletLog('SECURE', 'All threat markers operational');
            }, 4000);
        }
        
        // Create signal connections between markers
        function createSignalConnections() {
            if (!leafletMap || leafletMarkers.length < 2) return;
            
            addLeafletLog('SIGNAL', 'Establishing inter-node signal connections...');
            
            const userMarker = leafletMarkers[0]; // First marker is user location
            
            // Connect user to other markers
            for (let i = 1; i < leafletMarkers.length; i++) {
                if (Math.random() > 0.3) { // 70% chance to create connection
                    setTimeout(() => {
                        const targetMarker = leafletMarkers[i];
                        createSignalLine(userMarker, targetMarker);
                        addLeafletLog('SIGNAL', `Signal link established to remote node`);
                    }, i * 500);
                }
            }
        }
        
        // Create animated signal line between two markers
        function createSignalLine(marker1, marker2) {
            const latlng1 = marker1.getLatLng();
            const latlng2 = marker2.getLatLng();
            
            const signalLine = L.polyline([latlng1, latlng2], {
                color: '#7cff7c',
                weight: 2,
                opacity: 0.7,
                className: 'leaflet-signal-line'
            }).addTo(leafletMap);
            
            leafletSignalLines.push(signalLine);
            
            // Add pulsing effect
            let opacity = 0.7;
            let increasing = false;
            
            setInterval(() => {
                if (increasing) {
                    opacity += 0.05;
                    if (opacity >= 1) increasing = false;
                } else {
                    opacity -= 0.05;
                    if (opacity <= 0.3) increasing = true;
                }
                signalLine.setStyle({opacity: opacity});
            }, 100);
        }
        
        // Update Leaflet trace display
        function updateLeafletTraceDisplay() {
            if (!leafletUserData) return;
            
            // Update IP with glitch effect
            const ipElement = document.querySelector('#leaflet-cyber-map .ip-address .glitch-text');
            if (ipElement) {
                ipElement.textContent = leafletUserData.ip;
                ipElement.setAttribute('data-text', leafletUserData.ip);
            }
            
            // Update other fields with delays
            setTimeout(() => updateLeafletField('leaflet-target-city', `${leafletUserData.city}, ${leafletUserData.region}`), 1000);
            setTimeout(() => {
                const ispElement = document.getElementById('leaflet-target-isp');
                if (ispElement) {
                    ispElement.textContent = leafletUserData.isp;
                    ispElement.classList.remove('redacted');
                }
            }, 2000);
            setTimeout(() => {
                const coords = `${leafletUserData.lat?.toFixed(4)}, ${leafletUserData.lng?.toFixed(4)}`;
                updateLeafletField('leaflet-target-coords', coords);
            }, 3000);
        }
        
        // Update individual Leaflet field
        function updateLeafletField(elementId, value) {
            const element = document.getElementById(elementId);
            if (!element || !value) return;
            
            element.textContent = '';
            let i = 0;
            
            const typeWriter = () => {
                if (i < value.length) {
                    element.textContent += value.charAt(i);
                    i++;
                    setTimeout(typeWriter, 40 + Math.random() * 40);
                }
            };
            
            typeWriter();
        }
        
        // Add log entry for Leaflet system
        function addLeafletLog(type, message) {
            const container = document.getElementById('leaflet-trace-log');
            if (!container) return;
            
            const timestamp = new Date().toLocaleTimeString('en-US', {hour12: false});
            
            const logEntry = document.createElement('div');
            logEntry.className = 'trace-log';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-type log-${type.toLowerCase()}">[${type}]</span>
                ${message}
            `;
            
            container.appendChild(logEntry);
            container.scrollTop = container.scrollHeight;
            
            // Limit logs
            while (container.children.length > 12) {
                container.removeChild(container.firstChild);
            }
            
            leafletLogCount++;
        }
        
        // Update threat level indicator
        function updateThreatLevel(percentage) {
            const threatFill = document.getElementById('threat-fill');
            const threatStatus = document.getElementById('threat-status');
            
            if (threatFill) {
                threatFill.style.width = `${percentage}%`;
            }
            
            if (threatStatus) {
                if (percentage < 30) {
                    threatStatus.textContent = 'LOW';
                    threatStatus.style.color = '#7cff7c';
                } else if (percentage < 70) {
                    threatStatus.textContent = 'MODERATE';
                    threatStatus.style.color = '#ffd93d';
                } else {
                    threatStatus.textContent = 'HIGH';
                    threatStatus.style.color = '#ff6b6b';
                }
            }
            
            addLeafletLog('SIGNAL', `Threat level updated: ${percentage}%`);
        }
        
        // Generate mock data for Leaflet
        function generateLeafletMockData() {
            const locations = [
                {
                    city: 'Berlin', region: 'Germany', 
                    lat: 52.5200, lng: 13.4050, 
                    isp: 'Deutsche Telekom Cyber Division',
                    ip: '85.214.132.47'
                },
                {
                    city: 'Tokyo', region: 'Japan', 
                    lat: 35.6762, lng: 139.6503, 
                    isp: 'NTT Cyber Intelligence',
                    ip: '118.240.156.89'
                },
                {
                    city: 'London', region: 'United Kingdom', 
                    lat: 51.5074, lng: -0.1278, 
                    isp: 'BT Cyber Security',
                    ip: '81.134.67.123'
                },
                {
                    city: 'Amsterdam', region: 'Netherlands', 
                    lat: 52.3676, lng: 4.9041, 
                    isp: 'KPN Advanced Networks',
                    ip: '92.31.78.156'
                }
            ];
            
            return locations[Math.floor(Math.random() * locations.length)];
        }
        
        // Close Leaflet map
        window.closeLeafletCyberMap = function() {
            const overlay = document.getElementById('leaflet-cyber-map');
            overlay.classList.remove('active');
            
            // Clean up map resources
            if (leafletMap) {
                leafletMap.remove();
                leafletMap = null;
            }
            
            leafletMarkers = [];
            leafletSignalLines = [];
            addLeafletLog('TRACE', 'Leaflet Cyber Surveillance System deactivated');
        };
  </script>

  <!-- ▸▸  CTOS GEO‑FOOTPRINT  ◂◂ -->
  <section id="geo-footprint" class="neon-panel">
    <h2>CTOS GEO‑FOOTPRINT</h2>

    <!-- map lives here -->
    <div id="geo-map-wrap">
        <div id="geo-map"></div>          <!-- MapLibre GL attaches here -->
        <div class="leaflet-cyber-grid"></div> <!-- the green scan‑line overlay -->
    </div>

    <pre id="ip-readout">acquiring public ip…</pre> <!-- your IP / coord read‑out -->
    <p class="legal">
      location is approximate and based on <code>ipapi.co</code> (free tier). no PII stored.
    </p>
  </section>

  <script>
  /* ─── CTOS GEO‑FOOTPRINT (MapLibre GL Vector) ───────────────── */
  window.addEventListener('load', cyberMapLibre);

  async function cyberMapLibre(){
    const box = document.getElementById('geo-map-wrap');
    const readout = document.getElementById('ip-readout');
    
    if (!box) return; // Container not found
    
    // Check if MapLibre GL is loaded
    if (typeof maplibregl === 'undefined') {
      console.error('[CTOS] MapLibre GL not loaded - check CDN connection');
      if (readout) readout.textContent = 'CTOS ERROR: MapLibre GL library not loaded';
      return;
    }
    
    console.log('[CTOS] Initializing vector mapping system...');
    box.classList.add('glitching');               // start glitch while loading tiles

    /* 1 ‑ IP lookup -------------------------------------------------------- */
    let lat=0, lon=0, city='Demo‑Mode', ip='?.?.?.?', region='CLASSIFIED';
    try{
      const j = await fetch('https://ipapi.co/json/').then(r=>r.json());
      lat=j.latitude || 0; 
      lon=j.longitude || 0; 
      city=j.city || j.region || 'UNKNOWN'; 
      region=j.region || 'CLASSIFIED';
      ip=j.ip || '?.?.?.?';
      
      // If we got (0,0) coordinates, that means geolocation failed
      if (lat === 0 && lon === 0) {
        throw new Error('Geolocation returned null coordinates');
      }
    }catch(e){
      console.warn('[CTOS] ipapi blocked or failed, using demo coordinates');
      // Use London coordinates as fallback
      lat = 51.5074; lon = -0.1278; city = 'LONDON'; region = 'UK'; ip = '127.0.0.1';
    }

    /* 2 ‑ Update read‑out under the frame ----------------------------------- */
    if (readout) {
      readout.textContent = 
`IP:    ${ip}
CITY:  ${city}
REGION: ${region}
COORD: ${lat.toFixed(3)}, ${lon.toFixed(3)}
STATUS: VECTOR TRACE ACTIVE`;
    }

    /* 3 ‑ MapLibre GL Vector Init ------------------------------------------ */
    const center = [lon, lat];
    const map = new maplibregl.Map({
      container: 'geo-map',
      style: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',  // DarkMatter with labels
      center: center,
      zoom: 11,
      attributionControl: false,   // we'll add manual credit
      interactive: true,           // Allow interaction for cyberpunk feel
      preserveDrawingBuffer: true  // Better for rendering stability
    });

    // Store map globally for resize handling
    window.ctosMap = map;
    window.cyberMap = map;  // Also store with the name used by overlay system

    map.on('error', (e) => {
      console.warn('[CTOS] MapLibre error:', e);
      // Fallback to raster tiles if vector fails
      initRasterFallback();
    });

    /* 4 ‑ Add HUD Trace Marker when map loads ------------------------------ */
    map.on('load', () => {
      // Stop glitch animation
      box.classList.remove('glitching');
      
      // Ensure proper map sizing after load
      setTimeout(() => {
        map.resize();  // MapLibre GL resize method
      }, 100);
      
      // Add pulsing trace dot
      map.addSource('trace', { 
        type: 'geojson',
        data: { "type": "Point", "coordinates": center }
      });
      
      map.addLayer({
        id: 'trace-dot',
        type: 'circle',
        source: 'trace',
        paint: {
          'circle-radius': [
            'interpolate',
            ['linear'],
            ['zoom'],
            8, 6,    // zoom level 8: radius 6
            15, 12   // zoom level 15: radius 12
          ],
          'circle-color': '#00ff6b',
          'circle-opacity': 0.9,
          'circle-blur': 0.6,
          'circle-stroke-width': 2,
          'circle-stroke-color': '#7cff7c',
          'circle-stroke-opacity': 0.8
        }
      });
      
      // Add pulsing animation to the trace dot
      let pulseRadius = 8;
      let growing = true;
      
      setInterval(() => {
        if (growing) {
          pulseRadius += 0.5;
          if (pulseRadius >= 14) growing = false;
        } else {
          pulseRadius -= 0.5;
          if (pulseRadius <= 6) growing = true;
        }
        
        map.setPaintProperty('trace-dot', 'circle-radius', pulseRadius);
      }, 200);
      
      console.log('[CTOS] Vector geolocation matrix initialized');
    });

    /* 7 ‑ Glitch effect functions ------------------------------------------ */
    function glitchMap(){
      const glitch = document.querySelector('.leaflet-cyber-grid');
      if (glitch) {
        glitch.style.opacity = '0.3';
        setTimeout(() => { glitch.style.opacity = '1'; }, 100);
      }
    }

    // Random glitches on map interactions
    map.on('load', () => {
      if (Math.random() > 0.8) glitchMap();
    });

    // Manual glitch trigger every 12 seconds
    setInterval(() => {
      if (Math.random() > 0.6) glitchMap();
    }, 12000);

    /* 6 ‑ Click handlers for map interactivity ----------------------------- */
    map.on('click', () => {
      if (Math.random() > 0.7) glitchMap();
    });
    
    /* 8 ‑ Raster tile fallback if vector fails ------------------------------ */
    function initRasterFallback() {
      console.warn('[CTOS] Falling back to raster tiles');
      // Clear the container and create a simple raster map
      const container = document.getElementById('geo-map');
      container.innerHTML = `
        <div style="width:100%;height:100%;background:#000;display:flex;align-items:center;justify-content:center;color:#00ff6b;font-family:'Press Start 2P',monospace;font-size:12px;">
          CTOS RADAR OFFLINE<br><br>
          IP: ${ip}<br>
          LOCATION: ${city}<br>
          COORDS: ${lat.toFixed(3)}, ${lon.toFixed(3)}
        </div>
      `;
      box.classList.remove('glitching');
    }
    
    console.log('[CTOS] MapLibre vector system operational');
  }

  /* ─── Geo-Section Map Controls ───────────────────────────────── */
  
  // Ensure proper map sizing on window resize
  window.addEventListener('resize', () => {
    const mapContainer = document.getElementById('geo-map');
    if (mapContainer && window.ctosMap) {
      setTimeout(() => {
        window.ctosMap.resize();
      }, 250);
    }
  });
  
  // Make map globally accessible for debugging
  window.addEventListener('load', () => {
    // Wait for map to be created
    setTimeout(() => {
      const geoSection = document.getElementById('geo-footprint');
      if (geoSection) {
        // Add some interactive keyboard shortcuts for the geo section
        document.addEventListener('keydown', (e) => {
          // Ctrl+M to focus/scroll to geo section
          if (e.ctrlKey && e.key === 'm') {
            e.preventDefault();
            geoSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
          // Ctrl+O to test overlay system (for debugging)
          if (e.ctrlKey && e.key === 'o') {
            e.preventDefault();
            if (typeof window.openLeafletCyberMap === 'function') {
              window.openLeafletCyberMap();
            }
          }
          // Escape to close overlay
          if (e.key === 'Escape') {
            if (typeof window.closeLeafletCyberMap === 'function') {
              window.closeLeafletCyberMap();
            }
          }
        });
      }
    }, 1000);
  });
  
  // Helper function for manual map resize (accessible from console)
  window.resizeCtosMap = function() {
    if (window.ctosMap) {
      console.log('[CTOS] Manually triggering map resize...');
      window.ctosMap.resize();
      return 'Map resize triggered';
    } else {
      return 'No CTOS map found';
    }
  };

  /* ─── Overlay Map System Integration ────────────────────── */
  
  // Function to open the cyber map overlay with proper resize handling
  window.openLeafletCyberMap = function() {
    const panel = document.getElementById('leaflet-cyber-map');
    if (panel) {
      panel.classList.add('active');
      console.log('[CTOS] Cyber map overlay activated');
      
      // Give the CSS transition time to finish, then resize any maps
      setTimeout(() => {
        if (window.ctosMap) {
          window.ctosMap.resize();
          console.log('[CTOS] Map resized after overlay animation');
        }
      }, 350);  // Wait for slide-in animation to complete
    }
  };

  // Function to close the cyber map overlay
  window.closeLeafletCyberMap = function() {
    const panel = document.getElementById('leaflet-cyber-map');
    if (panel) {
      panel.classList.remove('active');
      console.log('[CTOS] Cyber map overlay deactivated');
    }
  };
  </script>

  <style>
  /* ——— section placement & look ——— */
  #geo-section{
    margin:100px auto 40px;
    max-width:1200px;padding:30px 24px;
    border:2px solid #00ff6b;border-radius:10px;
    background:rgba(0,15,0,.9);box-shadow:0 0 18px #00ff6b88;
    font:13px/1.6 'Roboto Mono',monospace;color:#7cff7c;
  }
  /* ── New Geo-Footprint Panel Styles ────────────────── */
  #geo-footprint{
    position:relative;padding:1.5rem 1.5rem 2rem;
    background:rgba(0,15,0,0.6);border:2px solid #00ff6b;border-radius:12px;
    box-shadow:0 0 20px rgba(0,255,107,0.3);
    margin:2rem 0;
  }
  #geo-footprint h2{
    margin:0 0 1.5rem;font:700 18px 'Press Start 2P',monospace;
    color:#00ff6b;text-shadow:0 0 12px #00ff6b;letter-spacing:.5px;
  }
  #geo-map-wrap{position:relative;width:100%;height:480px;overflow:hidden;
                border:1px solid #00ff6b;border-radius:6px;background:#081108;}
  #geo-map      {width:100%;height:100%;}   /* MapLibre GL takes these dims */

  /* Remove the old "fixed" overlay rules so they don't fight us */
  #leaflet-cyber-map,
  #ctos-gmap-overlay{display:none;}

  /* Old styles - now integrated into geo-footprint */
  /* .geo-title and #leaflet-cyber styles moved to #geo-footprint above */
  
  /* Ensure MapLibre GL container has proper dimensions */
  #geo-map {
    width:100% !important;height:100% !important;
    position:absolute;top:0;left:0;
    min-height:400px;          /* match parent minimum */
  }
  
  /* Make sure MapLibre GL canvas renders properly */
  #geo-map .maplibregl-canvas {
    width:100% !important;height:100% !important;
  }
  #ip-readout{
    margin-top:8px;padding:8px;
    font:12px 'Roboto Mono',monospace;color:#7cff7c;
    background:rgba(0,15,0,0.7);border:1px solid #00ff6b55;border-radius:4px;
    /* This is the active IP readout for the geo-section MapLibre GL map */
  }
  
  /* ─── MapLibre GL Vector Cyberpunk Styling ────────────────── */
  #geo-map canvas {
    /* Enhanced cyberpunk filter for DarkMatter tiles */
    filter: brightness(1.2) contrast(1.4) saturate(0.8) hue-rotate(95deg);
  }

  /* Glitch scan-line overlay for new structure */
  .leaflet-cyber-grid{
    position:absolute;inset:0;pointer-events:none;z-index:1000;
    background:repeating-linear-gradient(0deg,
        transparent 0 1px,rgba(0,255,128,0.04) 1px 3px);
    animation: ctosScanning 8s linear infinite;
  }
  @keyframes ctosScanning{to{background-position:0 3px}}

  /* glitch shimmer on the frame while the tiles load */
  @keyframes mapGlitch{0%,18%{opacity:.85;transform:translate(1px,0)}
  20%,38%{opacity:.60;transform:translate(-1px,0)}
  40%,58%{opacity:.90;transform:translate(1px,0)}
  60%,78%{opacity:.50;transform:translate(-1px,0)}
  80%,100%{opacity:1;transform:none}}
  #geo-map-wrap.glitching{animation:mapGlitch .7s linear 5;}

  /* Map glitch overlay */
  #map-glitch {
    position:absolute;inset:0;pointer-events:none;z-index:2000;
    background:transparent;opacity:0;transition:opacity 0.1s;
  }
  #map-glitch.active {
    opacity:1;
    background:radial-gradient(circle,rgba(0,255,107,0.3) 0%,transparent 60%);
  }

  /* MapLibre GL attribution styling */
  .maplibregl-ctrl-attrib {
    background:rgba(0,20,0,.9) !important;
    color:#7cff7c !important;
    border:1px solid #00ff6b !important;
  }
  .maplibregl-ctrl-attrib a {
    color:#00ff6b !important;
  }
  
  /* ——— MapLibre marker styles ——— */
  .user-location-marker{
    width:20px;height:20px;border-radius:50%;
    background:#00ff6b;border:2px solid #7cff7c;
    box-shadow:0 0 15px #00ff6b,inset 0 0 8px rgba(0,255,107,.3);
    animation:markerPulse 2s ease-in-out infinite;
  }
  @keyframes markerPulse{
    0%,100%{transform:scale(1);box-shadow:0 0 15px #00ff6b,inset 0 0 8px rgba(0,255,107,.3)}
    50%{transform:scale(1.2);box-shadow:0 0 25px #00ff6b,0 0 35px #00ff6b44,inset 0 0 12px rgba(0,255,107,.5)}
  }
  .signal-connection{
    position:absolute;height:2px;background:linear-gradient(90deg,#00ff6b,transparent);
    animation:signalPulse 3s ease-out forwards;opacity:0;pointer-events:none;
  }
  @keyframes signalPulse{
    0%{opacity:0;width:0}
    20%{opacity:1}
    100%{opacity:0;width:var(--line-length,100%)}
  }
  
  /* ——— MapLibre GL Custom Cyberpunk Styling ——— */
  .maplibregl-canvas{
    filter: brightness(.85) contrast(1.3) saturate(1.1)
            drop-shadow(0 0 4px #00ff6b);
  }
  
  /* kill the boiler‑plate disclaimer */
  .legal{display:none!important}
  </style>

  <!-- ✦ faux context menu – appears on right‑click ✦ -->
  <div id="decoy-menu" style="
     position:fixed;top:-200px;left:-200px;width:180px;padding:12px;
     background:rgba(0,20,0,.96);border:2px solid #7cff7c;border-radius:8px;
     font:700 9px 'Press Start 2P',monospace;color:#7cff7c;z-index:4000;
     box-shadow:0 0 22px #7cff7c99;pointer-events:none;transition:opacity .3s;">
    <div>HEX GRID ANALYSIS …</div>
    <div style="margin-top:6px;opacity:.6;">trace mutex() → 0x00</div>
    <div>quantum salt() → 0xFF</div>
    <div>packet forge() → ERR</div>
  </div>

  <script>
  /* right‑click trap with self‑destruct */
  document.addEventListener('contextmenu', e => {
    e.preventDefault();                 // stop real menu
    const box = document.getElementById('decoy-menu');
    box.style.top  = `${e.clientY}px`;  // move to cursor
    box.style.left = `${e.clientX}px`;
    box.style.opacity = 1;
    setTimeout(() => box.style.opacity = 0, 900);   // fade out
  });
  </script>

  <!-- ── CTOS GEO.FOOTPRINT (FIXED)  ───────────────────────────────────────────── -->
  <script>
  // Global map instance to prevent re-creation
  window.cyberMap = null;
  
  async function openCTOSMap(){
    const overlay = document.getElementById('ctos-gmap-overlay');
    const container = document.getElementById('cyber-maplibre');
    
    if (!overlay || !container) {
      console.error('CTOS map containers not found');
      return;
    }
    
    // Show overlay first
    overlay.classList.add('active');
    
    // Wait for slide-in animation to complete
    await new Promise(resolve => setTimeout(resolve, 850));
    
    // Only build map once
    if (window.cyberMap) {
      window.cyberMap.resize();
      return;
    }

    try {
      // 1️⃣ Get IP geolocation data first
      console.log('Fetching geolocation...');
      const response = await fetch('https://ipapi.co/json/');
      const info = await response.json();
      
      const {latitude: lat, longitude: lng, ip, city, region, org} = info;
      
      if (!lat || !lng) {
        throw new Error('Invalid coordinates received');
      }

      // 2️⃣ Create MapLibre map with valid coordinates
      console.log(`Creating map at ${lat}, ${lng}`);
      window.cyberMap = new maplibregl.Map({
        container: 'cyber-maplibre',
        style: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
        center: [lng, lat],
        zoom: 11,
        attributionControl: false
      });

      // 3️⃣ Add neon marker when map loads
      window.cyberMap.on('load', () => {
        const el = document.createElement('div');
        el.className = 'user-location-marker';
        new maplibregl.Marker(el).setLngLat([lng, lat]).addTo(window.cyberMap);
        console.log('Map loaded with marker');
      });

      // 4️⃣ Update HUD display
      const updateElement = (selector, value) => {
        const el = document.querySelector(selector);
        if (el) el.textContent = value;
      };
      
      updateElement('#trace-city', city || 'Unknown');
      updateElement('#trace-region', region || 'Classified');
      updateElement('#trace-isp', org || 'Unknown ISP');
      updateElement('#trace-coords', `${lat.toFixed(3)}, ${lng.toFixed(3)}`);
      updateElement('.ip-address', ip || '?.?.?.?');

      // 5️⃣ Update status indicators
      const geoStatus = document.getElementById('geo-status');
      const signalStatus = document.getElementById('signal-status');
      if (geoStatus) geoStatus.className = 'status-dot status-success';
      if (signalStatus) signalStatus.className = 'status-dot status-success';
      
      console.log('CTOS map initialized successfully');

    } catch (error) {
      console.error('Failed to initialize CTOS map:', error);
      
      // Fallback with demo coordinates
      window.cyberMap = new maplibregl.Map({
        container: 'cyber-maplibre',
        style: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
        center: [-0.13, 51.5], // London
        zoom: 10,
        attributionControl: false
      });
      
      // Add demo marker
      window.cyberMap.on('load', () => {
        const el = document.createElement('div');
        el.className = 'user-location-marker';
        new maplibregl.Marker(el).setLngLat([-0.13, 51.5]).addTo(window.cyberMap);
      });
      
      // Update HUD with demo data
      const updateElement = (selector, value) => {
        const el = document.querySelector(selector);
        if (el) el.textContent = value;
      };
      
      updateElement('#trace-city', 'Demo Mode');
      updateElement('#trace-region', 'Unknown');
      updateElement('#trace-isp', 'Offline');
      updateElement('#trace-coords', '51.500, -0.130');
      updateElement('.ip-address', '[BLOCKED]');
    }
  }
  
  // Make function globally available
  window.openCTOSMap = openCTOSMap;
  
  // Also handle the clean geo-section map
  (async ()=>{
    const ipReadout = document.querySelector('#ip-readout');
    const mapContainer = document.querySelector('#map-libre');
    
    if (!ipReadout || !mapContainer) return; // Clean section not found
    
    try {
      // Get geolocation for clean section
      const response = await fetch('https://ipapi.co/json/');
      const data = await response.json();
      
      // Update text readout
      ipReadout.textContent = 
`IP:    ${data.ip || '?.?.?.?'}
CITY:  ${data.city || '---'}  
COORD: ${data.latitude?.toFixed(3) || '?'}, ${data.longitude?.toFixed(3) || '?'}`;

      // Create simple map for clean section
      const simpleMap = new maplibregl.Map({
        container: 'map-libre',
        style: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
        center: [data.longitude || 0, data.latitude || 0],
        zoom: 10,
        attributionControl: false
      });

      // Add marker
      simpleMap.on('load', () => {
        new maplibregl.Marker({color: '#ff6b6b'})
          .setLngLat([data.longitude || 0, data.latitude || 0])
          .addTo(simpleMap);
      });

    } catch (error) {
      console.warn('Clean geo-section failed:', error);
      ipReadout.textContent = 
`IP:    [BLOCKED]
CITY:  Demo Mode
COORD: 0, 0`;
    }
  })();
  </script>

</body>
</html>
